<apex:page controller="CORE_Proposal_Review_Controller" sidebar="false" cache="false">
    <script src="//cdn.ckeditor.com/4.7.1/standard/ckeditor.js"></script>
    <title>Proposal Review</title>
    <style>
        .editorialPgCollapseDiv {
          color: white !important;
          width: 100%;
          margin: 5px;
        }
        .cke_button__about {
            display:none !important;
        }
        .cke_toolbar_break {
            display: none !important;
            clear: left;
        }
        .cke_path {
            display:none !important;
        }
        #errorMessage, #infoMessage{
            display: none;
        }
        #contentWrapper {
            max-width:100%
        }
        @media (min-width: 1200px) {
            .content {
                max-width: 97vw;
            }
        }
        .tableLargerWidth_3271 {
            width:3271px;
            max-width:5000px
        }
        .tableLargerWidth_2500 {
            width:2500px;
            max-width:5000px
        }
        .tableLargerWidth_1285 {
            width:1285px;
            max-width:5000px
        }
        .tableLargerWidth_2000 {
            width:2000px;
            max-width:5000px
        }
        .thLargerColumn {
            width:250px;
        }
        .w140 {
            width: 140px;
        }

        .w100percent {
          width: 100%;
        }

        .table > thead > tr > th {
            white-space: normal;
        }
        .split .lookupInput {
            display: block;
        }

        .rank{
            width: 50px !important;
        }

        input[title="User"]{
            height: 30px;
            padding: 5px 10px;
            font-size: 12px;
            line-height: 1.5;
            border-radius: 0px;
        }

        .currency{
            width: 155px;
        }

        .currencySign{
            display: inline;
        }

        .currencySBC{
           display: inline;
           width: 155px;
        }
        .alert-container {
            max-width: 100% !important;
            padding-left: 0px;
        }
        .textAreaWidth {
            margin: 0px;
            width: 550px    ;
            height: 73px;
        }
        .w150 {
            width: 150px !important;
        }
        .w50 {
            width: 50px;
        }
        .w180 {
            width: 180px;
        }
        .mt23 {
            margin-top: 23px;
        }
        .w10 {
            width: 10%;
        }
        .w1033 {
            width: 10.33%;
        }
        .w12 {
          width: 12%;
        }
        .w48 {
            width: 48%;
        }
        .w4367 {
            width: 43.67%;
        }
        .w100 {
            width: 100px;
        }
        .hr-div {
            border-top: 1px solid #ccc;
            margin-top: 20px;
            border-bottom: 1px solid #ccc;
            padding-bottom: 2px;
            margin-bottom: 20px;
        }
        .text-center {
            text-align: center;
        }
        .text-justify {
            text-align: justify;
            word-wrap: break-word;
        }
        .mt-5 {
            margin-top: -5px;
        }
        textarea.form-control {
            height:80px;
        }
        .textareabox {
            height:100%;
        }
        .required {
            font-weight: bold;
            color: red;
        }
        .backToSolicitaton {
            margin: 10px 0px 10px 0px;
        }
        .scoreMatrix {
            margin-top:25px;
        }
        .modal-dialog-matrix {
            width: 900px;
        }
        .sk-folding-cube, .loading-overlay{
            z-index: 10000;
        }
        .groupNameTitle {
            word-wrap: break-word !important;
            white-space: pre-wrap !important;
            width: 365px !important;
        }
        .margin_15_0_5_15 {
            margin: 15px 0 5px 15px;
        }
        .ml25 {
            margin-left: 25px;
        }
        .link_style_manage_group {
            color: white;
            margin: auto;
            padding-right: 10px;
            cursor: pointer;
        }
        .editGrpPanel {
            margin-left:420%;
        }

        /* Hamburger CSS */
        .sidenav {
            height: 100%;
            width: 0;
            position: absolute;
            z-index: 100;
            left: 0px;
            background-color: #eee;
            overflow-x: hidden;
            transition: 0.5s;
            padding-top: 60px;
        }

        .sidenav a {
            padding: 8px 8px 8px 32px;
            text-decoration: none;
            color: #818181;
            display: block;
            transition: 0.3s
        }

        .offcanvas a:focus{
            color: #f1f1f1;
        }

        .sidenav .closebtn {
            position: absolute;
            top: 0;
            right: 25px;
            font-size: 36px;
            margin-left: 50px;
        }

        .sidenav a.nav-menu:hover {
           background-color:#005898;
           color: #fff;
        }

        @media screen and (max-height: 450px) {
          .sidenav {padding-top: 15px;}
          .sidenav a {font-size: 18px;}
        }

        .table-controls.reset a {
            padding: 2px 0px 15px;
        }
        .edit-div-input {
            padding: 8px 0 8px 12px;
        }
        .downloadLink {
            text-align: right;
            text-decoration: none;
            margin-top: 1px;
            margin-bottom: 10px;
        }
        .modal-body {
            padding: 10px 20px 20px;
        }
        .recuse {
            width:6%;
        }

        body{
            overflow-x: hidden;
        }

        .projMgrSelect2 {
          min-width: 250px !important;
        }
        .cursor-pointer {
            cursor: pointer;
        }
        .sorting-icon {
            margin-left: 3px;
        }
        .fixed-content {
          overflow: auto;
          display: block;
        }
        .flex-row-copy {
        margin-bottom: 3px;
        position: relative;
        background-color: #19366A;
        font-weight: 600;
        height: 35px;
    }
    .pb3 {
      padding-bottom: 1px;
      padding-top: 2px;
    }
    .mt2 {
      margin-top: 2px;
    }
    .ml10 {
      margin-left: 10px;
    }
    .notificationBodyDiv {
      padding: 10px 15px 0 15px;
    }
    .tableDiv {
        max-height: 500px;
        overflow: auto;
        position: relative;
    }
    #reviewTable-header {
      position: absolute;
      z-index: 99;
    }

    </style>
    <link href="//maxcdn.bootstrapcdn.com/font-awesome/4.1.0/css/font-awesome.min.css" rel="stylesheet" />

    <apex:composition template="CORE_TemplateBlank">
        <apex:define name="body">
            <div class="page">
                <apex:actionstatus id="counterStatus">
            <apex:facet name="start">
               <div class="sk-folding-cube">
                  <div class="sk-cube1 sk-cube"></div>
                  <div class="sk-cube2 sk-cube"></div>
                  <div class="sk-cube4 sk-cube"></div>
                  <div class="sk-cube3 sk-cube"></div>
               </div>
               <div class="loading-overlay"></div>
            </apex:facet>
         </apex:actionstatus>
         <div class="content">
                <apex:form id="form">

                  <!-- START : Hamburger Menu -->
                  <div id="mySidenav" class="sidenav">
                      <a href="javascript:void(0)" class="closebtn" onclick="closeNav()">&times;</a>
                      <a class="nav-menu" href="#" onclick="backToSolicitation()"> Back to solicitation </a>
                      <apex:outputPanel rendered="{!(isProjectCoordinator || isProgramManager || isSolicitationManager || isSystemAdmin) && currentSolicitation.Score_Type__c == 'Batch Rank'}" layout="none">
                          <a href="#" class="nav-menu" onclick="populateSolicitationGroupList();">Manage Groups</a>
                      </apex:outputPanel>
                      <apex:outputPanel rendered="{!proj.Status__c == 'Under Review' && (isProjectCoordinator || isContractOfficeManager || isProgramManager || isSolicitationManager || isSystemAdmin)}" layout="none">  <!-- I-03011 -->
                        <apex:commandLink styleClass="nav-menu" action="{!fetchProposalMatrix}" value="Score Matrix" reRender="modalFormMatrixScoring"
                                        status="counterStatus" oncomplete="matrixScoringOpenModal();manageUI();return false;"/>
                      </apex:outputPanel>
                      <apex:outputPanel rendered="{!isfinlizeScoreNeeded && (isProjectCoordinator || isContractOfficeManager || isProgramManager || isSolicitationManager || isSystemAdmin)}" layout="none">  <!-- I-03011 -->
                        <a href="#" class="nav-menu" onclick="openFinalizeScoreConfirmationModal();">Finalize Score</a>
                      </apex:outputPanel>
                </div>

                <apex:outputPanel layout="none" rendered="{!liprogramversion.size > 0}">
                    <span style="font-size:22px; cursor:pointer" onclick="openNav()"> &#9776; Menu</span>
                </apex:outputPanel>

                  <!-- <div class="row">
                    <div class="col-xs-1">
                      <div class="dropdown">
                        <button class="btn btn-default dropdown-toggle" type="button" id="dropdownMenu1" data-toggle="dropdown" aria-haspopup="true" aria-expanded="true">
                            Menu <span class="caret"></span>
                        </button>
                        <ul class="dropdown-menu" aria-labelledby="dropdownMenu1">
                            <li>
                                <apex:commandLink action="{!backToSolicitation}" value="Back to Grant Opprtunities" />
                            </li>
                            <li><a href="#">Review Team Members</a></li>
                            <apex:outputPanel rendered="{!isProgramStaff}" layout="none">
                                <li><a href="#" onclick="populateSolicitationGroupList();">Manage Groups</a></li>
                            </apex:outputPanel>

                            <apex:outputPanel rendered="{!proj.Status__c == 'Under Review' && isConceptPaper && isProgramStaff}" layout="none">
                                <li>
                                    <apex:commandLink action="{!fetchProposalMatrix}" value="Score Matrix" reRender="modalFormMatrixScoring" oncomplete="matrixScoringOpenModal(); return false;"/>
                                </li>
                            </apex:outputPanel>
                        </ul>
                      </div>
                    </div>
                  </div> -->
                  <!-- FINISH : Hamburger Menu -->

                  <div class="alert-container">
                      <apex:outputPanel id="errorPanel1">
                          <apex:messages />
                      </apex:outputPanel>

                      <div class="alert alert-danger" id="errorMessage">
                          <strong>Error! <span class="errStr"></span></strong>
                      </div>

                      <apex:outputPanel rendered="{!hasErrorWithRecommendedFundingEmpty}">
                          <div class="alert alert-danger">
                              <strong>Error! </strong>Recommended funding value must be provided. If it does not apply please enter 0.
                          </div>
                      </apex:outputPanel>

                      <apex:outputPanel rendered="{!hasError}">
                          <div class="alert alert-danger">
                              <strong>Error! </strong>Distribution amount does not match with recommended funding amount.
                          </div>
                      </apex:outputPanel>

                      <apex:outputPanel rendered="{!hasErrorWithProjectManagerEmpty}">
                          <div class="alert alert-danger">
                              <strong>Error! </strong>Please provide Project Manager.
                          </div>
                      </apex:outputPanel>

                       <apex:outputPanel rendered="{!isSuccessfullySaved}" styleClass="successMessage">
                          <div class="alert alert-success">
                              <strong>{!$Label.Clean_Transportation_Proposal_Review_Save_Message}</strong>
                          </div>
                      </apex:outputPanel>
                  </div>

                  <!-- <div class="backToSolicitaton">
                     <apex:outputPanel >
                            <apex:commandLink action="{!backToSolicitation}" value="Back to Grant Opprtunities" />
                      </apex:outputPanel>
                  </div> -->

                <apex:outputPanel layout="none" rendered="{!liprogramversion.size == 0}">
                    <div class="alert-container">
                        <div class="alert alert-danger">
                           <strong>No Grant Opportunity found</strong>
                        </div>
                    </div>
                </apex:outputPanel>

                <apex:outputPanel layout="none" rendered="{!liprogramversion.size > 0}">
                    <div class="row">
                        <div class="col-xs-4">
                            <div class="filters">
                                <label for="{!$Component.programversion}">Grant Opportunity Name</label>
                                <div class="field">
                                    <apex:selectList id="programversion" value="{!selectedProgramVersion}" size="1" multiselect="false" styleClass="form-control input-sm programversion" >
                                        <apex:selectOptions value="{!liprogramversion}"/>
                                    </apex:selectList>
                                </div>
                            </div>
                         </div>

                         <div class="col-xs-2 w1033">
                            <div class="filters">
                                <label for="{!$Component.sRound}">Round</label>
                                <div class="field">

                                   <apex:selectList styleClass="form-control input-sm md" size="1" multiselect="false" id="sRound" value="{!proj.Solicitation_Round__c}">
                                        <apex:selectOptions value="{!solicitationRoundList}"/>
                                    </apex:selectList>
                                </div>
                            </div>
                        </div>

                        <div class="col-xs-2">
                            <div class="filters">
                                <label for="{!$Component.Status}">Status</label>
                                <div class="field">
                                    <apex:selectList styleClass="form-control input-sm filter-status" size="1" multiselect="false" value="{!proj.Status__c}" id="Status">
                                        <apex:selectOptions value="{!statusFilterList}"/>
                                    </apex:selectList>
                                </div>
                            </div>
                        </div>

                        <div class="col-xs-2">
                            <div class="filters">
                                <label for="{!$Component.category}">Category</label>
                                <div class="field">
                                    <apex:selectList styleClass="form-control input-sm" size="1" multiselect="false" value="{!selectedCategory}" id="category">
                                        <apex:selectOptions value="{!categoryFilterList}"/>
                                    </apex:selectList>
                                </div>
                            </div>
                        </div>

                        <div class="col-xs-2 w12">
                            <div class="filters">
                                <label for="{!$Component.cPaper}">Concept Paper?</label>
                                <div class="field">
                                    <apex:inputCheckbox id="cPaper" value="{!isConceptPaper}"/>
                                </div>
                            </div>
                        </div>

                        <div class="col-xs-1">
                            <div class="filters">
                                <apex:commandButton id="btn2" action="{!startRetrieval}" html-aria-label="button" value="Filter" rerender="form, scriptPanel" Status="counterStatus"
                                        oncomplete="disabledPicklist();removePicklistVal(); updateReccPicklistVal('{!isConceptPaper}');$('.successMessage').hide();resetSelectAllCheckbox();manageUI(); greenlightValueChangedReset('{!greenlightValueChanged}','{!isConceptPaper}');" styleClass="btn-bs btn-default btn-sm mt23 " />
                            </div>
                        </div>
                    </div>

                    <div class="row" style="margin: 0;">
                        <div class="col-xs-12 hr-div">
                            <div class="text-center mt-5"><strong>...</strong></div>
                        </div>
                    </div>


                    <apex:outputPanel rendered="{!liproposalWrapper.size > 0}" layout="none">
                        <div class="row">
                            <div class="col-xs-2">
                                <apex:outputPanel rendered="{!proj.Status__c != 'Under Review'}" layout="none">
                                    <div class="filters">
                                        <label for="{!$Component.UpdateStatus}">Update Status To</label>
                                        <div class="field">
                                            <apex:selectList styleClass="form-control input-sm updateStatus" size="1" multiselect="false" value="{!updateStatusTo}"
                                                     id="UpdateStatus" onchange="changeSelectedStatus()">
                                                <apex:selectOptions value="{!statusList}"/>
                                            </apex:selectList>
                                        </div>
                                    </div>
                                </apex:outputPanel>
                                <!-- <apex:outputPanel rendered="{!proj.Status__c == 'Under Review' && isConceptPaper && isProgramStaff}" layout="none">
                                    <div class="scoreMatrix">
                                        <apex:commandLink action="{!fetchProposalMatrix}" value="Score Matrix" reRender="modalFormMatrixScoring" oncomplete="matrixScoringOpenModal(); return false;"/>
                                    </div>
                                </apex:outputPanel> -->
                            </div>

                            <div class="col-xs-6">
                                &nbsp;
                            </div>

                            <div class="col-xs-2 w10">
                                <apex:outputPanel rendered="{!allowProposalUpdation}">
                                    <div class="filters">
                                        <label for="{!$Component.saveProjBtn}">&nbsp; <span style="display:none;">Button</span></label>
                                        <button  type="button" class="btn-bs btn-primary btn-sm mt23" id="saveProjBtn" onclick="saveRecordsJS(); return false">Save</button>
                                    </div>
                                </apex:outputPanel>
                            </div>

                            <div class="col-xs-2">
                                <apex:outputPanel rendered="{!proj.Status__c == 'Under Review'}">
                                    <div class="filters">
                                        <label for="{!$Component.export}">&nbsp; <span style="display:none;">export</span> </label>
                                        <a class="btn-bs btn-sm btn-default mt23" id="export" href="{!URLFOR($Page.CORE_Proposal_Review_Download_Page,null,[status=proj.Status__c,isExport=true,round=proj.Solicitation_Round__c,solicitationID=selectedProgramVersion,isConceptPaper=isConceptPaper])}" target="_blank">Export </a>
<!--                                         <apex:commandButton action="{!URLFOR($page.CORE_Proposal_Review_Download_page,null,[status=proj.Status__c,round=proj.Solicitation_Round__c,selectedProgramVersion=selectedProgramVersion])}" value="Export" rerender="form"/> -->
                                    </div>
                                </apex:outputPanel>
                            </div>

                        </div>
                    </apex:outputPanel>

                      <!-- <div class="panel-control">
                         <div class="filters">

                            <label for="phase">Solicitation:</label>
                            <div class="field">
                                <apex:selectList id="programversion" value="{!selectedProgramVersion}" size="1" multiselect="false" styleClass="form-control input-sm md programversion" >
                                    <apex:selectOptions value="{!liprogramversion}"/>
                                </apex:selectList>
                            </div>

                            <label for="phase">Concept Paper:</label>
                            <div class="w50">
                                <apex:inputCheckbox value="{!isConceptPaper}"/>
                            </div>

                            <label for="date">Solicitation Round:</label>
                            <div class="field">
                                <apex:selectList styleClass="form-control input-sm md" size="1" multiselect="false" value="{! proj.Solicitation_Round__c}">
                                    <apex:selectOptions value="{!solicitationRoundList}"/>
                                </apex:selectList>
                            </div>
                            <label for="Status">Status:</label>
                            <div class="field w150">
                                <apex:selectList styleClass="form-control input-sm" size="1" multiselect="false" value="{!proj.Status__c}" id="Status">
                                    <apex:selectOptions value="{!statusList}"/>
                                </apex:selectList>
                            </div>

                            <div class="controls" style="padding-left:30px;">
                                <apex:commandButton action="{!startRetrieval}" value="Filter" rerender="form" Status="counterStatus" styleClass="btn-bs btn-default btn-sm" />

                                <apex:commandButton action="{!URLFOR($page.CORE_Proposal_Review_Download_page,null,[status=proj.Status__c,round=proj.Solicitation_Round__c,selectedProgramVersion=selectedProgramVersion])}" value="Export" rerender="form"/>
                                <a class="btn-bs btn-sm btn-default" href="{!URLFOR($Page.CORE_Proposal_Review_Download_Page,null,[status=proj.Status__c,round=proj.Solicitation_Round__c,solicitationID=selectedProgramVersion])}" target="_blank">Export</A>
                                <apex:commandButton action="{!saveRecords}" value="Save" rerender="form" Status="counterStatus" styleClass="btn-bs btn-primary btn-sm" />
                                <a href="javascript:void(0)" onclick="saveAction()" class="btn-bs btn-primary btn-sm">Save</a>
                             </div>
                         </div>
                        </div> -->

                    <div class="row">
                        &nbsp;
                    </div>

                    <apex:outputPanel rendered="{!liproposalWrapper.size ==0}" >
                        No Records Found
                    </apex:outputPanel>

                    <apex:outputPanel id="mainTable">
                    <apex:outputPanel rendered="{!liproposalWrapper.size >0}" layout="none" >
                        <apex:actionFunction name="save" action="{!saveRecords}" rerender="form" status="counterStatus" oncomplete="manageUI();" />

                    <div class="table-responsive tableDiv">
                      <table id="reviewTable-header" class="table table-condensed table-striped table-default upper table-bordered {!IF(proj.Status__c == 'Under Review', 'tableLargerWidth_2500', IF(OR(proj.Status__c == 'Submitted', proj.Status__c == 'Pending Review'), 'tableLargerWidth_1285','tableLargerWidth_2000'))}" cellspacing="0">

            </table>
                    <table id="reviewTable" class="table table-condensed table-striped table-default upper table-bordered {!IF(proj.Status__c == 'Under Review', 'tableLargerWidth_2500', IF(OR(proj.Status__c == 'Submitted', proj.Status__c == 'Pending Review'), 'tableLargerWidth_1285','tableLargerWidth_2000'))}" cellspacing="0">
                        <thead>
                            <apex:outputPanel rendered="{!OR(proj.Status__c == 'Submitted', proj.Status__c == 'Pending Review') }" layout="none">
                                <tr>
                                    <th>
                                        <apex:inputCheckbox html-aria-label="CheckBox" styleClass="selectAll" onclick="selectAllCheckbox();"/> <span style="display:none;">CheckBox</span>
                                    </th>
                                    <th class="cursor-pointer" onclick="sortData('Proposal_Number__c');">Proposer Number
                                      <i class="sorting-icon fa {!IF(prevSortFieldName == 'Proposal_Number__c', If(isAsc, 'fa-sort-asc', 'fa-sort-desc'), '')}"></i>
                                    </th>
                                    <th class="cursor-pointer" onclick="sortData('Proposed_Proposal_Category__c');">Proposed Category
                                      <i class="sorting-icon fa {!IF(OR(prevSortFieldName == 'Proposed_Proposal_Category__c', prevSortFieldName == '', prevSortFieldName == null), If(isAsc, 'fa-sort-asc', 'fa-sort-desc'), '')}"></i>
                                    </th>
                                    <th>Proposer Name</th>
                                    <th class="thLargerColumn">Proposal Title</th>
                                    <th style="{!IF(isConceptPaper, 'display:none', '')}">Confidential</th>
                                    <th>Documents</th>
                                    <apex:outputPanel rendered="{!proj.Status__c == 'Pending Review' && currentSolicitation.Score_Type__c == 'Batch Rank'}" layout="none">
                                        <th class="w180">Assigned Group</th>
                                    </apex:outputPanel>
                                    <th>Status</th>
                                    <th>Solicitation Round</th>
                                    <th>Proposed Cost</th>
                                    <th>Proposed Cost Share</th>
                                    <th>Proposed Total Cost</th>
                                </tr>
                            </apex:outputPanel>

                            <apex:outputPanel rendered="{!proj.Status__c == 'Under Review'}" layout="none" >
                                <tr>
                                    <th class="cursor-pointer" onclick="sortData('Proposal_Number__c');">Proposer Number
                                      <i class="sorting-icon fa {!IF(prevSortFieldName == 'Proposal_Number__c', If(isAsc, 'fa-sort-asc', 'fa-sort-desc'), '')}"></i>
                                    </th>
                                    <th style="{!IF(OR(isContractOfficeManager, isProgramManager, isSolicitationManager, isProjectCoordinator), '', 'display:none')}"> <span style="display:none;">Manager</span> </th> <!-- Accessibility fix -->
                                    <th class="cursor-pointer" onclick="sortData('Proposed_Proposal_Category__c');">Proposed Category
                                        <i class="sorting-icon fa {!IF(OR(prevSortFieldName == 'Proposed_Proposal_Category__c', prevSortFieldName == '', prevSortFieldName == null), If(isAsc, 'fa-sort-asc', 'fa-sort-desc'), '')}"></i></th>
                                    <th style="{!IF(OR(isProgramManager, isSolicitationManager, isContractOfficeManager, isProjectCoordinator), '', 'display:none')}">Rank</th>
                                    <th>Proposer Name</th>
                                    <th class="thLargerColumn">Proposal Title</th>
                                    <th style="{!IF(isConceptPaper, 'display:none', '')}">Confidential</th>
                                    <th>Documents</th>
                                    <th>Proposal Score</th>
                                    <th class="thLargerColumn" style="{!IF(!isContractOfficeManager, '', 'display:none')}">Objective / Scope</th>
                                    <th class="thLargerColumn" style="{!IF(!isContractOfficeManager, '', 'display:none')}">Impacts / Benefits</th>
                                    <th class="thLargerColumn" style="{!IF(!isContractOfficeManager, '', 'display:none')}">Proposal Strengths</th>
                                    <th class="thLargerColumn" style="{!IF(!isContractOfficeManager, '', 'display:none')}">Proposal Weaknesses</th>
                                    <th class="thLargerColumn" style="{!IF(OR(isConceptPaper, isContractOfficeManager), 'display:none', '')}">Risks</th>
                                    <th>Requested Funding $</th>
                                    <th style="{!IF(OR(isConceptPaper, isScoringCommiteeMember, isProgramStaff), 'display:none', '')}">Recommended Funding $</th>
                                    <th style="{!IF(!isContractOfficeManager, '', 'display:none')}">Contingencies / Recommendations</th>
                                    <th class="thLargerColumn" style="{!IF(!isContractOfficeManager, '', 'display:none')}">Additional Information for Award Letter</th>
                                    <th style="{!IF(OR(isProgramManager, isSolicitationManager, isContractOfficeManager, isProjectCoordinator), '', 'display:none')}">Scoring Committee Recommendation</th>
                                    <th style="{!IF(OR(isProgramManager, isSolicitationManager, isContractOfficeManager, isProjectCoordinator), '', 'display:none')}">Team Recommendation</th>
                                    <th class="thLargerColumn" style="{!IF(OR(isProgramManager, isSolicitationManager, isContractOfficeManager, isProjectCoordinator), '', 'display:none')}">
                                        {!If(isConceptPaper, 'Director Approval', 'Greenlight Approval')}
                                    </th>
                                    <th style="{!IF(OR(isConceptPaper, isScoringCommiteeMember, isProgramStaff), 'display:none', '')}">Recoupment</th>
                                    <th style="{!IF(OR(isConceptPaper, isScoringCommiteeMember, isProgramStaff), 'display:none', '')}">Accepts T&amp;C</th>
                                    <th style="{!IF(isConceptPaper, 'display:none', '')}">Project Manager</th>
                                    <th style="padding: 0;width:730px; {!IF(OR(isConceptPaper, isScoringCommiteeMember, isProgramStaff), 'display:none', '')} " >
                                        <table class="table table-condensed table-striped table-default upper table-bordered" cellspacing="0" style="width:730px; height: 35px;">
                                            <tr>
                                                <th class="thLargerColumn">Fund</th>
                                                <th class="w180">Amount</th>
                                                <th class="w100">Project</th>
                                                <th class="w100">Activity</th>
                                                <th class="w100">Account</th>
                                            </tr>
                                        </table>
                                    </th>
                                </tr>
                            </apex:outputPanel>

                            <apex:outputPanel rendered="{!AND(proj.Status__c != 'Submitted', proj.Status__c != 'Pending Review', proj.Status__c != 'Under Review') }" layout="none">
                                <tr>
                                    <th>
                                        <apex:inputCheckbox id="selectAll" html-aria-label="CheckBox" styleClass="selectAll" onclick="selectAllCheckbox();"/>
                                    </th>
                                    <th class="cursor-pointer" onclick="sortData('Proposal_Number__c');">Proposer Number
                                      <i class="sorting-icon fa {!IF(prevSortFieldName == 'Proposal_Number__c', If(isAsc, 'fa-sort-asc', 'fa-sort-desc'), '')}"></i>
                                    </th>
                                    <th class="cursor-pointer" onclick="sortData('Proposed_Proposal_Category__c');">Proposed Category
                                      <i class="sorting-icon fa {!IF(OR(prevSortFieldName == 'Proposed_Proposal_Category__c', prevSortFieldName == '', prevSortFieldName == null), If(isAsc, 'fa-sort-asc', 'fa-sort-desc'), '')}"></i>
                                    </th>
                                    <th>Rank</th>
                                    <th class="thLargerColumn">Project Name</th>
                                    <th style="{!IF(isConceptPaper, 'display:none', '')}">Confidential</th>
                                    <th>Solicitation Round</th>
                                    <th>Status</th>
                                    <th>Proposer</th>
                                    <th>Proposed Cost</th>
                                    <th>Proposed Cost Share</th>
                                    <th>Proposed Total Cost</th>
                                    <th>Recommended Funding</th>
                                    <th>Project PM </th>
                                    <apex:outputPanel rendered="{!proj.Status__c == 'Awarded'}" layout="none">
                                        <apex:repeat value="{!mapoflifunnding[selectedProgramVersion]}" var="va" rendered="{!AND(NOT(ISBLANK(selectedProgramVersion)),mapfundingexist[selectedProgramVersion])}">
                                            <th>{!va.name}</th>
                                        </apex:repeat>
                                    </apex:outputPanel>
                                </tr>
                            </apex:outputPanel>
                        </thead>
                        <tbody>
                            <apex:variable var="i" value="{!0}" />
                            <apex:outputPanel id="tableData" layout="none">
                                <apex:repeat value="{!liproposalWrapper}" var="lpw">
                                    <apex:variable var="i" value="{!i+1}" />
                                    <apex:outputPanel rendered="{!AND(proj.Status__c != 'Submitted', proj.Status__c != 'Pending Review', proj.Status__c != 'Under Review')}" layout="none">
                                        <tr>
                                            <td>
                                                <apex:inputCheckbox html-aria-label="CheckBox" value="{!lpw.isSelected}" styleClass="checkbox{!i} checkbox" onclick="checkForPicklistDisbaled()"/>
                                            </td>
                                            <td> {!lpw.pro.Proposal_Number__c}</td>
                                            <td> {!lpw.pro.Proposed_Proposal_Category__c} </td>
                                            <td>
                                               <apex:outputPanel rendered="{!isProgramStaff}">
                                                    <apex:inputField styleClass="input-sm rank" value="{!lpw.pro.Proposal_Rank__c}"/>
                                                </apex:outputPanel>
                                                <apex:outputPanel rendered="{!!isProgramStaff}">
                                                    <apex:outputField styleClass="input-sm rank" value="{!lpw.pro.Proposal_Rank__c}"/>
                                                </apex:outputPanel>
                                            </td>
                                            <td>
                                                <apex:outputPanel rendered="{!isProgramStaff}">
                                                    <a href="/{!lpw.pro.id}" target="_blank" class="projectName{!i}">{!lpw.pro.name}</a>
                                                </apex:outputPanel>
                                                <apex:outputPanel rendered="{!!isProgramStaff}">
                                                    <a href="/apex/PROPOSAL_CORE_Review_page?ProjectId={!lpw.pro.id}" target="_blank" class="projectName{!i}">{!lpw.pro.name}</a>
                                                </apex:outputPanel>
                                            </td>
                                            <td style="{!IF(isConceptPaper, 'display:none', '')}" class="text-center">
                                                <apex:image alt="checkbox" URL="{!if(lpw.isConfidential,'/img/checkbox_checked.gif','/img/checkbox_unchecked.gif')}"/>
                                            </td>
                                            <td>
                                                {!lpw.pro.Solicitation_Round__r.name}
                                            </td>
                                            <td>
                                                <apex:outputField styleClass="input-sm status{!i} status-dropdown" value="{!lpw.pro.Status__c}"/>
                                            </td>
                                            <td>
                                                <!-- {!lpw.roleContractor.firstname__c}&nbsp;{!lpw.roleContractor.lastname__c} -->
                                                {!lpw.roleContractor.Account_Name_Hidden__c}
                                            </td>
                                            <td>
                                                <apex:outputField value="{!lpw.pro.Proposed_NYSERDA_Cost__c}"/>
                                            </td>
                                            <td>
                                                <apex:outputField value="{!lpw.pro.Propsoed_Cost_Share__c}"/>
                                            </td>
                                            <td>
                                              <apex:outputText value="${0,number,##,###,##0.00}">
                                                <apex:param value="{!lpw.pro.Total_Project_Cost_Estimated__c}"/>
                                            </apex:outputText>
                                            </td>
                                            <td>
                                                <apex:outputField styleClass="input-sm currency" value="{!lpw.pro.Recommended_NYSERDA_Funding__c}"/>
                                            </td>
                                            <td class="split">
                                                <apex:outputPanel styleClass="projMgrSelect2" rendered="{!OR(isContractOfficeManager,isProgramManager,isSolicitationManager,isProjectCoordinator)}"> <!-- I-03011 I-03013 -->

                                                        <apex:selectList value="{!lpw.roleManager.User__c}"
                                                                          styleClass="form-control programFamilySelection select2 lg projMgrSelect2"
                                                                          size="1" multiselect="false">
                                                            <apex:selectOptions value="{!projManagerUserOptionList}"/>
                                                        </apex:selectList>

                                                </apex:outputPanel>
                                                <apex:outputPanel rendered="{!AND(!isContractOfficeManager,!isProgramManager, !isSolicitationManager, !isProjectCoordinator)}">  <!-- I-03011 I-03013 -->
                                                    <apex:outputField value="{!lpw.roleManager.User__c}"/>
                                                </apex:outputPanel>
                                            </td>
                                            <apex:outputPanel rendered="{!proj.Status__c == 'Awarded'}" layout="none">
                                                <apex:repeat value="{!mapoflifunnding[selectedProgramVersion]}" var="va" rendered="{!AND(NOT(ISBLANK(selectedProgramVersion)),mapfundingexist[selectedProgramVersion])}">
                                                    <apex:outputPanel rendered="{!AND(lpw.proFund.size > 0, CONTAINS(lpw.availableFunds, va.Name))}" layout="none">
                                                        <td>
                                                            <apex:outputText styleClass="input-sm currency" value="{!lpw.fundToAmountMap[va.name]}"/>
                                                        </td>
                                                    </apex:outputPanel>
                                                    <apex:outputPanel rendered="{!AND(lpw.proFund.size > 0, !CONTAINS(lpw.availableFunds, va.Name))}" layout="none">
                                                        <td></td>
                                                    </apex:outputPanel>
                                                    <apex:outputPanel rendered="{!!(lpw.proFund.size > 0)}" layout="none">
                                                        <td></td>
                                                    </apex:outputPanel>
                                                </apex:repeat>
                                            </apex:outputPanel>
                                        </tr>
                                    </apex:outputPanel>

                                    <apex:outputPanel rendered="{!proj.Status__c == 'Under Review'}" layout="none" id="underReviewTablePanel">
                                        <tr>
                                            <td> {!lpw.pro.Proposal_Number__c}</td>
                                            <td style="{!IF(OR(isContractOfficeManager, isProgramManager, isSolicitationManager,isProjectCoordinator), '', 'display:none')}"> <!-- I-03011 -->
                                                <apex:commandLink id="prLink" action="{!fetchCurrentProject}" reRender="modalFormProjectReview" style="text-decoration:none" oncomplete="projectReviewOpenModal(); manageUI(); return false;">
                                                     <img alt="edit" src="/img/func_icons/util/pencil12.gif"/>
                                                     <apex:param name="indexNumber" value="{!i}" assignTo="{!rowNumber}"/>
                                                 </apex:commandLink>
                                            </td>

                                            <td> {!lpw.pro.Proposed_Proposal_Category__c} </td>
                                            <td style="{!IF(OR(isProgramManager, isSolicitationManager, isContractOfficeManager, isProjectCoordinator), '', 'display:none')}">
                                                <apex:outputPanel rendered="{!OR(isContractOfficeManager,isProgramManager,isSolicitationManager,isProjectCoordinator)}"> <!-- I-03011 -->
                                                    <apex:inputField styleClass="input-sm rank" value="{!lpw.pro.Proposal_Rank__c}"/>
                                                </apex:outputPanel>
                                                <!-- I-03011 -->
                                                <!--
                                                <apex:outputPanel rendered="{!isProjectCoordinator}">
                                                    <apex:outputField styleClass="input-sm rank" value="{!lpw.pro.Proposal_Rank__c}"/>
                                                </apex:outputPanel>
                                                -->
                                            </td>
                                            <td> {!lpw.roleContractor.Account_Name_Hidden__c} </td>
                                            <td>
                                                <apex:outputPanel rendered="{!isProgramStaff}">
                                                    <a href="/{!lpw.pro.id}" target="_blank" class="projectName{!i}">{!lpw.pro.name}</a>
                                                </apex:outputPanel>
                                                <apex:outputPanel rendered="{!!isProgramStaff}">
                                                    <a href="/apex/PROPOSAL_CORE_Review_page?ProjectId={!lpw.pro.id}" target="_blank" class="projectName{!i}">{!lpw.pro.name}</a>
                                                </apex:outputPanel>
                                            </td>
                                            <td style="{!IF(isConceptPaper, 'display:none', '')}" class="text-center">
                                                <apex:image alt="checkbox" URL="{!if(lpw.isConfidential,'/img/checkbox_checked.gif','/img/checkbox_unchecked.gif')}"/>
                                            </td>
                                             <td>
                                                   <!--  <a href="/apex/PROPOSAL_CORE_Documents_Page?ProjectId={!lpw.pro.id}" target="_blank" class="docName{!i}">
                                                    Link
                                                </a>  -->
                                                    <a href="https://desedemo-demo-lp.cs196.force.com/dese/s/grant-application?projectId={!lpw.pro.id}&currentStep=6" target="_blank" class="docName{!i}">
                                                    Link
                                                </a>
                                            </td>
                                            <td>
                                                 <apex:commandLink id="scoringLink" onclick="clearmodalFormScoringWindow();" action="{!fetchProposalScoring}" reRender="scriptPanel, modalFormScoring, confirmationModalPanel" immediate="true"
                                                                                    Status="counterStatus" style="text-decoration:none" oncomplete="openScoringModal(); manageUI(); return false;">
                                                    <img alt="edit" src="/img/func_icons/util/pencil12.gif"/>
                                                    <apex:param name="indexNumber" value="{!i}" assignTo="{!rowNumber}"/>
                                                 </apex:commandLink>
                                            </td>

                                            <td style="{!IF(!isContractOfficeManager, '', 'display:none')}">
                                                    <apex:outputText escape="false" value="{!lpw.pro.Description__c}" styleClass="objective"/>
                                                    <span class="objective{!i} hidden">
                                                        ...<br/>
                                                        <div class="pull-right">
                                                            <a href="javascript:void(0)" onclick="showValue('{!lpw.pro.Description__c}', 'Objective / Scope')"> Show More </a>
                                                        </div>
                                                    </span>
                                             </td>
                                            <td style="{!IF(!isContractOfficeManager, '', 'display:none')}">
                                                <apex:outputText escape="false" value="{!lpw.pro.Impacts_Benefits__c}" styleClass="impact"/>
                                                <span class="impact{!i} hidden">
                                                    ...<br/>
                                                    <div class="pull-right">
                                                        <a href="javascript:void(0)" onclick="showValue('{!lpw.pro.Impacts_Benefits__c}', 'IMPACTS / BENEFITS')"> Show More </a>
                                                    </div>
                                                </span>
                                            </td>
                                            <td style="{!IF(!isContractOfficeManager, '', 'display:none')}">
                                                <apex:outputText escape="false" value="{!lpw.pro.Proposal_Strengths__c}" styleClass="strength"/>
                                                <span class="strength{!i} hidden">
                                                    ...<br/>
                                                    <div class="pull-right">
                                                        <a href="javascript:void(0)" onclick="showValue('{!lpw.pro.Proposal_Strengths__c}', 'PROPOSAL STRENGTHS')"> Show More </a>
                                                    </div>
                                                </span>

                                            </td>
                                            <td style="{!IF(!isContractOfficeManager, '', 'display:none')}">
                                                <apex:outputText escape="false" value="{!lpw.pro.Proposal_Weaknesses__c}" styleClass="weekness"/>
                                                <span class="weekness{!i} hidden">
                                                    ...<br/>
                                                    <div class="pull-right">
                                                        <a href="#" onclick="showValue('{!lpw.pro.Proposal_Weaknesses__c}', 'PROPOSAL WEAKNESSES')"> Show More </a>
                                                    </div>
                                                </span>
                                            </td>
                                            <td style="{!IF(OR(isConceptPaper, isContractOfficeManager), 'display:none', '')}">
                                                <apex:outputText escape="false" value="{!lpw.pro.Proposal_Risks__c}" styleClass="risk"/>
                                                <span class="risk{!i} hidden">
                                                    ...<br/>
                                                    <div class="pull-right">
                                                        <a href="javascript:void(0)" onclick="showValue('{!lpw.pro.Proposal_Risks__c}', 'RISKS')"> Show More </a>
                                                    </div>
                                                </span>
                                            </td>

                                            <td>
                                                <apex:outputField value="{!lpw.pro.Proposed_NYSERDA_Cost__c}"/>
                                            </td>
                                            <td style="{!IF(OR(isConceptPaper, isProgramStaff, isScoringCommiteeMember), 'display:none', '')}">
                                                <apex:outputPanel rendered="{!OR(isProgramManager,isSolicitationManager, isContractOfficeManager, isProjectCoordinator)}" layout="none">
                                                    <apex:inputField styleClass="input-sm form-control" value="{!lpw.pro.Recommended_NYSERDA_Funding__c}"/>
                                                </apex:outputPanel>

                                                <!--
                                                <apex:outputPanel rendered="{!isProjectCoordinator}">
                                                    <apex:outputField styleClass="input-sm currency currency{!i}" value="{!lpw.pro.Recommended_NYSERDA_Funding__c}"/>
                                                </apex:outputPanel>
                                                -->

                                            </td>

                                            <td style="{!IF(!isContractOfficeManager, '', 'display:none')}">
                                                <apex:outputText escape="false" value="{!lpw.pro.Contingencies_Recommendations__c}" styleClass="contingencies-recommendation"/>
                                                <span class="contingencies-recommendation{!i} hidden">
                                                    ...<br/>
                                                    <div class="pull-right">
                                                        <a href="javascript:void(0)" onclick="showValue('{!lpw.pro.Contingencies_Recommendations__c}', 'CONTINGENCIES / RECOMMENDATIONS')"> Show More </a>
                                                    </div>
                                                </span>
                                            </td>

                                            <td style="{!IF(!isContractOfficeManager, '', 'display:none')}">
                                                <apex:outputText escape="false" value="{!lpw.pro.Additional_Information_for_Award_Letter__c}" styleClass="awardLetter"/>
                                                <span class="awardLetter{!i} hidden">
                                                    ...<br/>
                                                    <div class="pull-right">
                                                        <a href="javascript:void(0)" onclick="showValue('{!lpw.pro.Additional_Information_for_Award_Letter__c}', 'ADDITIONAL INFORMATION FOR AWARD LETTER' )"> Show More </a>
                                                    </div>
                                                </span>
                                             </td>

                                            <td style="{!IF(OR(isProgramManager,isSolicitationManager, isContractOfficeManager, isProjectCoordinator), '', 'display:none')}">

                                                <apex:outputPanel rendered="{!OR(isProgramManager,isSolicitationManager, isContractOfficeManager)}" layout="none">  <!-- I-03292 -->

                                                    <apex:inputField onChange="syncWithOtherRcmdIfApplicable(this.value, '{!lpw.pro.Id}'); manageApprovalDropDown();"
                                                                     styleClass="input-sm form-control screcommendation w140 screcommendation{!i}"
                                                                     value="{!lpw.pro.Scoring_Committee_Recommendation__c}"/>

                                                </apex:outputPanel>

                                                <!-- I-03011/I-03292 -->

                                                <apex:outputPanel rendered="{!AND(!isProgramManager,!isSolicitationManager, !isContractOfficeManager)}">
                                                    <div class="w140"> {!lpw.pro.Scoring_Committee_Recommendation__c} </div>
                                                </apex:outputPanel>


                                            </td>

                                            <td style="{!IF(OR(isProgramManager, isSolicitationManager, isContractOfficeManager, isProjectCoordinator), '', 'display:none')}">

                                                <apex:outputPanel rendered="{!OR(isProgramManager,isSolicitationManager, isContractOfficeManager)}" layout="none"> <!-- I-03292 -->

                                                    <apex:inputField styleClass="input-sm form-control recommendation w140 teamRecommendationCls{!lpw.pro.Id} teamRecommendation{!i}"
                                                                     value="{!lpw.pro.Team_Recommendation__c}"
                                                                     onChange="manageApprovalDropDown();"/>

                                                </apex:outputPanel>

                                                <!-- I-03011/I-03292 -->
                                                <apex:outputPanel rendered="{!AND(!isProgramManager,!isSolicitationManager, !isContractOfficeManager)}">
                                                    <div class="w140"> {!lpw.pro.Team_Recommendation__c} </div>
                                                </apex:outputPanel>


                                            </td>

                                            <td>
                                                <!--  style="{!IF(OR(isProgramManager, isSolicitationManager, isContractOfficeManager, isProjectCoordinator), '', 'display:none')}" -->
                                                <!-- rendered="{!OR(AND(!isConceptPaper,isContractOfficeManager),AND(isConceptPaper,OR(isProgramManager, isSolicitationManager, isContractOfficeManager)))}" -->
                                                <apex:outputPanel layout="none"> <!-- T-03059 -->
                                                    <div class="flex-row" >
                                                      <apex:inputField styleClass="input-sm form-control recommendation w140 recommendation{!i}"
                                                                       value="{!lpw.pro.Recommendation__c}" onchange="insertFunds({!i})"/>
                                                        <!--
                                                        <apex:commandLink id="prLink2" styleClass="ml10" action="{!fetchCurrentProjectForPreview}"
                                                                             reRender="previewNotificationModalPanel"
                                                                             style="text-decoration:none"
                                                                             status="counterStatus"
                                                                             oncomplete="openNotificationPreviewModelWindow(); manageUI(); return false;"
                                                                             immediate="true">
                                                             <i class="fa fa-eye" aria-hidden="true"></i>
                                                             <apex:param name="indexNumber" value="{!i}" assignTo="{!rowNumber}"/>
                                                         </apex:commandLink>
                                                          -->
                                                    </div>
                                                </apex:outputPanel>
                                                <!--
                                                <apex:outputPanel rendered="{!OR(AND(!isConceptPaper,!isContractOfficeManager),AND(isConceptPaper,AND(!isProgramManager, !isSolicitationManager, !isContractOfficeManager)))}">
                                                    <div class="flex-row" >
                                                    {!lpw.pro.Recommendation__c}
                                                     <apex:commandLink id="prLink2ReadOnly" styleClass="ml10" action="{!fetchCurrentProjectForPreview}"
                                                                         reRender="previewNotificationModalPanel"
                                                                         style="text-decoration:none"
                                                                         status="counterStatus"
                                                                         oncomplete="openNotificationPreviewModelWindow(); manageUI(); return false;"
                                                                         immediate="true">
                                                         <i class="fa fa-eye" aria-hidden="true"></i>
                                                         <apex:param name="indexNumber" value="{!i}" assignTo="{!rowNumber}"/>
                                                     </apex:commandLink>
                                                     </div>
                                                </apex:outputPanel>
                                                -->
                                            </td>

                                            <td style="{!IF(OR(isConceptPaper, isScoringCommiteeMember, isProgramStaff), 'display:none', '')}"> {!lpw.pro.Recoupment__c} </td>
                                            <td style="{!IF(OR(isConceptPaper, isScoringCommiteeMember, isProgramStaff), 'display:none', '')}"> {!lpw.pro.Exceptions_to_T_C__c} </td>

                                            <td style="{!IF(isConceptPaper, 'display:none', '')}">
                                                <apex:outputPanel styleClass="projMgrSelect2" rendered="{!OR(isContractOfficeManager, isProgramManager, isSolicitationManager, isProjectCoordinator)}"> <!-- I-03011 -->

                                                    <!-- <apex:inputField value="{!lpw.roleManager.User__c}"/>  -->

                                                        <apex:selectList value="{!lpw.roleManager.User__c}"
                                                                          styleClass="form-control programFamilySelection select2 lg projMgrSelect2"
                                                                          size="1" multiselect="false">
                                                            <apex:selectOptions value="{!projManagerUserOptionList}"/>
                                                        </apex:selectList>


                                                </apex:outputPanel>
                                                <apex:outputPanel rendered="{!AND(!isContractOfficeManager,!isProgramManager, !isSolicitationManager, !isProjectCoordinator)}"> <!-- I-03011 -->
                                                    <apex:outputField value="{!lpw.roleManager.User__c}"/>
                                                </apex:outputPanel>
                                            </td>

                                            <td style="padding: 0;{!IF(OR(isConceptPaper, isScoringCommiteeMember, isProgramStaff), 'display:none', '')}">
                                                <table class="table table-condensed table-striped table-default upper table-bordered" cellspacing="0" style="width:730px; height: 46px;">
                                                    <apex:outputPanel rendered="{!lpw.proFund.size > 0}" layout="none">
                                                        <apex:variable var="j" value="{!1}" />
                                                        <apex:repeat value="{!lpw.proFund}" var="funding">
                                                            <tr>
                                                                <apex:outputPanel rendered="{!lpw.proFund.size > 1}" layout="none">
                                                                    <td style="width:50px">
                                                                        <!--
                                                                        <apex:inputCheckbox value="{!lpw.projectFundIdToIsSelectedMap[funding.Fund__c]}" styleClass="amountCB{!i}{!j}" onclick="setAmountField({!lpw.pro.Recommended_NYSERDA_Funding__c}, {!i}, {!j})"/>
                                                                         -->
                                                                    </td>
                                                                    <td style="width:200px">
                                                                        <apex:outputField styleClass="input-sm" value="{!funding.Fund__c}"/>
                                                                    </td>
                                                                </apex:outputPanel>
                                                                <apex:outputPanel rendered="{!lpw.proFund.size <= 1}" layout="none">
                                                                    <td style="width:250px">
                                                                        <apex:outputField styleClass="input-sm" value="{!funding.Fund__c}"/>
                                                                    </td>
                                                                </apex:outputPanel>



                                                                <td class="w180">
                                                                    <apex:outputPanel rendered="{!lpw.proFund.size <= 1}" >
                                                                        <apex:outputField styleClass="input-sm currency" value="{!funding.Distribution_Amount__c}"/>
                                                                    </apex:outputPanel>
                                                                    <apex:outputPanel rendered="{!lpw.proFund.size > 1}">
                                                                        <apex:inputText styleClass="input-sm currency disAmount{!i}{!j}" value="{!funding.Distribution_Amount__c}"/>
                                                                    </apex:outputPanel>
                                                                </td>
                                                                <td class="w100"> {!funding.Project_ID__c} </td>
                                                                <td class="w100"> {!funding.Activity_ID__c}</td>
                                                                <td class="w100"> {!funding.Account_Number__c}</td>
                                                            </tr>
                                                            <apex:variable var="j" value="{!j+1}" />
                                                        </apex:repeat>
                                                    </apex:outputPanel>

                                                    <apex:outputPanel rendered="{!lpw.proFund.size == 0}" layout="none">
                                                        <tr>
                                                            <td style="width:250px"></td>
                                                            <td class="w180"> </td>
                                                            <td class="w100"> </td>
                                                            <td class="w100"> </td>
                                                            <td class="w100"> </td>
                                                        </tr>
                                                    </apex:outputPanel>
                                                </table>
                                            </td>


                                            <!-- <apex:outputPanel rendered="{!lpw.proFund.size == 0}" layout="none">
                                                <td> </td>
                                                <td> </td>
                                                <td> </td>
                                                <td> </td>

                                            </apex:outputPanel>
                                            <apex:outputPanel rendered="{!lpw.proFund.size > 0}" layout="none">
                                                <td>
                                                    <apex:outputField styleClass="input-sm currency currency{!i}" value="{!lpw.proFund[0].Fund__c}"/>
                                                </td>
                                                <td>
                                                    <apex:outputField styleClass="input-sm currency currency{!i}" value="{!lpw.proFund[0].Distribution_Amount__c}"/>
                                                </td>
                                                <td> {!lpw.proFund[0].Project_ID__c} </td>
                                                <td> {!lpw.proFund[0].Activity_ID__c}</td>
                                                <td> {!lpw.proFund[0].Account_Number__c}</td>
                                            </apex:outputPanel> -->
                                        </tr>
                                    </apex:outputPanel>

                                    <apex:outputPanel rendered="{!OR(proj.Status__c == 'Submitted', proj.Status__c == 'Pending Review') }" layout="none">
                                        <tr>
                                            <td>
                                                <apex:inputCheckbox html-aria-label="CheckBox" value="{!lpw.isSelected}" styleClass="checkbox{!i} checkbox" onclick="checkForPicklistDisbaled()"/>
                                            </td>
                                            <td> {!lpw.pro.Proposal_Number__c}</td>
                                            <td> {!lpw.pro.Proposed_Proposal_Category__c} </td>
                                            <td class="split">
                                                <!-- {!lpw.roleContractor.firstname__c}&nbsp;{!lpw.roleContractor.lastname__c}  -->
                                                {!lpw.roleContractor.Account_Name_Hidden__c} <!-- T-02031 -->
                                            </td>
                                            <td>
                                                <apex:outputPanel rendered="{!isProgramStaff}">
                                                    <a href="/{!lpw.pro.id}" target="_blank" class="projectName{!i}">{!lpw.pro.name}</a>
                                                </apex:outputPanel>
                                                <apex:outputPanel rendered="{!!isProgramStaff}">
                                                    <a href="/apex/PROPOSAL_CORE_Review_page?ProjectId={!lpw.pro.id}" target="_blank" class="projectName{!i}">{!lpw.pro.name}</a>
                                                </apex:outputPanel>
                                            </td>
                                            <td style="{!IF(isConceptPaper, 'display:none', '')}" class="text-center">
                                                <apex:image alt="checkbox" URL="{!if(lpw.isConfidential,'/img/checkbox_checked.gif','/img/checkbox_unchecked.gif')}"/>
                                            </td>
                                            <td>
                                              <!--  <a href="/apex/PROPOSAL_CORE_Documents_Page?ProjectId={!lpw.pro.id}" target="_blank" class="docName{!i}">
                                                    Link
                                                </a> -->
                                                <a href="https://desedemo-demo-lp.cs196.force.com/dese/s/grant-application?projectId={!lpw.pro.id}&currentStep=6" target="_blank" class="docName{!i}">
                                                    Link
                                                </a>
                                            </td>

                                            <apex:outputPanel rendered="{!proj.Status__c == 'Pending Review' && currentSolicitation.Score_Type__c == 'Batch Rank'}" layout="none">
                                                <td class="w180">
                                                    <apex:outputPanel rendered="{!OR(isProgramManager, isSolicitationManager,isProjectCoordinator)}" >
                                                        <apex:selectList styleClass="form-control input-sm assignedGroup{!i}" size="1" multiselect="false" value="{!lpw.pro.Solicitation_Group__c}" id="Status">
                                                            <apex:selectOptions value="{!lpw.eligibleGroupList}"/>
                                                        </apex:selectList>
                                                    </apex:outputPanel>
                                                    <apex:outputPanel rendered="{!AND(!isProgramManager, !isSolicitationManager, !isProjectCoordinator)}" >
                                                        <apex:outputField value="{!lpw.pro.Solicitation_Group__r.Name}" />
                                                    </apex:outputPanel>
                                                </td>
                                            </apex:outputPanel>

                                            <td>
                                                <apex:outputPanel >

                                                    <apex:outputPanel rendered="{!OR(AND(proj.Status__c == 'Submitted', OR(isProgramManager, isSolicitationManager, isProjectCoordinator, isContractOfficeManager)), AND(proj.Status__c == 'Pending Review',OR(isProgramManager,isSolicitationManager,isProjectCoordinator)))}">
                                                        <apex:inputField styleClass="input-sm status{!i} status-dropdown" value="{!lpw.pro.Status__c}"/>
                                                    </apex:outputPanel>
                                                    <apex:outputPanel rendered="{!!OR(AND(proj.Status__c == 'Submitted', OR(isProgramManager,isSolicitationManager, isProjectCoordinator, isContractOfficeManager)), AND(proj.Status__c == 'Pending Review',OR(isProgramManager,isSolicitationManager,isProjectCoordinator)))}">
                                                        <apex:outputField styleClass="input-sm status{!i} status-dropdown" value="{!lpw.pro.Status__c}"/>
                                                    </apex:outputPanel>

                                                </apex:outputPanel>

                                            </td>
                                            <td>
                                                {!lpw.pro.Solicitation_Round__r.name}
                                            </td>
                                            <td>
                                                <apex:outputField value="{!lpw.pro.Proposed_NYSERDA_Cost__c}"/>
                                            </td>
                                            <td>
                                                <apex:outputField value="{!lpw.pro.Propsoed_Cost_Share__c}"/>
                                            </td>
                                            <td>
                                              <apex:outputText value="${0,number,##,###,##0.00}">
                                                <apex:param value="{!lpw.pro.Total_Project_Cost_Estimated__c}"/>
                                            </apex:outputText>
                                            </td>
                                        </tr>
                                    </apex:outputPanel>
                                </apex:repeat>
                            </apex:outputPanel>

                            <apex:outputPanel rendered="{!AND(proj.Status__c != 'Submitted', proj.Status__c != 'Pending Review', proj.Status__c != 'Under Review')}" layout="none">
                                <tr>
                                    <td> </td>
                                    <td> </td>
                                    <td> </td>
                                    <td style="{!IF(isConceptPaper, 'display:none', '')}"></td>
                                    <td> </td>
                                    <td> </td>
                                    <td> </td>
                                    <td> </td>
                                    <td> </td>
                                    <td>
                                        <apex:outputText value="${0,number,##,###,##0.00}">
                                            <apex:param value="{!sumtotalNysedra}"/>
                                        </apex:outputText>
                                    </td>
                                    <td>
                                        <apex:outputText value="${0,number,##,###,##0.00}">
                                            <apex:param value="{!sumtotalcostShare}"/>
                                        </apex:outputText>
                                    </td>
                                    <td>
                                        <apex:outputText value="${0,number,##,###,##0.00}">
                                            <apex:param value="{!sumtotalcost}"/>
                                        </apex:outputText>
                                    </td>
                                    <td>
                                        <apex:outputText value="${0,number,##,###,##0.00}">
                                            <apex:param value="{!sumremainingcost}"/>
                                        </apex:outputText>
                                    </td>
                                    <td> </td>
                                    <apex:outputPanel rendered="{!proj.Status__c == 'Awarded'}" layout="none">
                                        <apex:repeat value="{!mapoflifunnding[selectedProgramVersion]}" var="va" rendered="{!AND(NOT(ISBLANK(selectedProgramVersion)),mapfundingexist[selectedProgramVersion])}">
                                            <td>
                                                <apex:outputText styleClass="input-sm currency" value="{!fundToTotalAmountMap[va.name]}"/>
                                            </td>
                                        </apex:repeat>
                                    </apex:outputPanel>
                                </tr>
                            </apex:outputPanel>

                            <apex:outputPanel rendered="{!OR(proj.Status__c == 'Submitted', proj.Status__c == 'Pending Review') }" layout="none">
                                <tr>
                                    <td> </td>
                                    <td> </td>
                                    <td> </td>
                                    <td style="{!IF(isConceptPaper, 'display:none', '')}"></td>
                                    <td> </td>
                                    <td> </td>
                                    <td> </td>
                                    <td> </td>
                                    <apex:outputPanel rendered="{!proj.Status__c == 'Pending Review' && currentSolicitation.Score_Type__c == 'Batch Rank'}" layout="none">
                                        <td class="w180"></td>
                                    </apex:outputPanel>
                                    <td> </td>
                                    <td>
                                        <apex:outputText value="${0,number,##,###,##0.00}">
                                            <apex:param value="{!sumtotalNysedra}"/>
                                        </apex:outputText>
                                    </td>
                                    <td>
                                        <apex:outputText value="${0,number,##,###,##0.00}">
                                            <apex:param value="{!sumtotalcostShare}"/>
                                        </apex:outputText>
                                    </td>
                                    <td>
                                        <apex:outputText value="${0,number,##,###,##0.00}">
                                            <apex:param value="{!sumtotalcost}"/>
                                        </apex:outputText>
                                    </td>
                                </tr>
                            </apex:outputPanel>

                            <apex:outputPanel rendered="{!proj.Status__c == 'Under Review'}" layout="none">
                                <tr>
                                    <td> </td>
                                    <td style="{!IF(OR(isContractOfficeManager,isProgramManager,isSolicitationManager,isProjectCoordinator), '', 'display:none')}"> </td>
                                    <td> </td>
                                    <td style="{!IF(OR(isProgramManager,isSolicitationManager, isContractOfficeManager, isProjectCoordinator), '', 'display:none')}"> </td>
                                    <td> </td>
                                    <td style="{!IF(isConceptPaper, 'display:none', '')}"></td>
                                    <td> </td>
                                    <td> </td>
                                    <td> </td>
                                    <td style="{!IF(!isContractOfficeManager, '', 'display:none')}"> </td>
                                    <td style="{!IF(!isContractOfficeManager, '', 'display:none')}"> </td>
                                    <td style="{!IF(!isContractOfficeManager, '', 'display:none')}"> </td>
                                    <td style="{!IF(!isContractOfficeManager, '', 'display:none')}"> </td>
                                    <!-- <td > </td> -->
                                    <td style="{!IF(OR(isConceptPaper, isContractOfficeManager), 'display:none', '')}"> </td>
                                    <td>
                                        <apex:outputText value="${0,number,##,###,##0.00}">
                                            <apex:param value="{!sumtotalNysedra}"/>
                                        </apex:outputText>
                                    </td>
                                    <td style="{!IF(OR(isConceptPaper, isScoringCommiteeMember, isProgramStaff), 'display:none', '')}"> </td>
                                    <td style="{!IF(!isContractOfficeManager, '', 'display:none')}"> </td>
                                    <td style="{!IF(!isContractOfficeManager, '', 'display:none')}"> </td>
                                    <td style="{!IF(OR(isProgramManager,isSolicitationManager, isContractOfficeManager, isProjectCoordinator), '', 'display:none')}"> </td>
                                    <td style="{!IF(OR(isProgramManager,isSolicitationManager, isContractOfficeManager, isProjectCoordinator), '', 'display:none')}"> </td>
                                    <td style="{!IF(OR(isProgramManager,isSolicitationManager, isContractOfficeManager, isProjectCoordinator), '', 'display:none')}"> </td>
                                    <td style="{!IF(OR(isConceptPaper, isScoringCommiteeMember, isProgramStaff), 'display:none', '')}"> </td>
                                    <td style="{!IF(OR(isConceptPaper, isScoringCommiteeMember, isProgramStaff), 'display:none', '')}"> </td>
                                    <td style="{!IF(isConceptPaper, 'display:none', '')}"></td>
                                    <td style="{!IF(OR(isConceptPaper, isScoringCommiteeMember, isProgramStaff), 'display:none', '')}"> </td>
                                    <!-- <td style="{!IF(isConceptPaper, 'display:none', '')}"> </td> -->
                                </tr>
                            </apex:outputPanel>
                        </tbody>
                    </table>
                    <input type="hidden" id="proposalList" value="{!liproposalWrapper.size}" />

                    </div><!-- /.table-responsive -->
                      <script>
                          $('select[title="Search scope"]').hide();
                      </script>


                   <div class="row">
                        &nbsp;
                    </div>


                    <div class="row">

                        <div class="col-xs-8">
                            &nbsp;
                        </div>

                        <div class="col-xs-2 w10">
                            <apex:outputPanel rendered="{!allowProposalUpdation}">
                                <div class="filters">
                                    <label for="{!$Component.saveProjBtn}">&nbsp; <span style="display:none;">Button</span> </label>
                                    <button  type="button" class="btn-bs btn-primary btn-sm mt23" id="saveProjBtn" onclick="saveRecordsJS(); return false">Save</button>
                                </div>
                            </apex:outputPanel>
                        </div>

                        <div class="col-xs-2">
                            <apex:outputPanel rendered="{!proj.Status__c == 'Under Review'}">
                                <div class="filters">
                                    <label for="{!$Component.btn2}">&nbsp; <span style="display:none;">Export</span> </label>
                                    <a class="btn-bs btn-sm btn-default mt23" id="btn2" href="{!URLFOR($Page.CORE_Proposal_Review_Download_Page,null,[status=proj.Status__c,isExport=true,round=proj.Solicitation_Round__c,solicitationID=selectedProgramVersion])}" target="_blank">Export </a>
                                    <!-- <apex:commandButton action="{!URLFOR($page.CORE_Proposal_Review_Download_page,null,[status=proj.Status__c,round=proj.Solicitation_Round__c,selectedProgramVersion=selectedProgramVersion])}" value="Export" rerender="form"/> -->
                                </div>
                            </apex:outputPanel>
                        </div>
                    </div>

                    </apex:outputPanel>
                    </apex:outputPanel>



                    <div class="modal fade" id="editModal" role="dialog" aria-labelledby="editModalLabel">
                        <div class="modal-dialog" role="document">
                            <div class="modal-content">
                                <apex:outputPanel id="modalForm">
                                    <div class="modal-header">
                                        <b>Strength And Weakness</b>
                                        <button type="button" class="close" data-dismiss="modal" aria-label="Close">
                                            <span aria-hidden="true">&times;</span>
                                        </button>
                                        <h4 class="modal-title" id="editModalLabel"> <span style="display:none;">Heading</span> </h4>
                                    </div>
                                    <div class="modal-body">
                                       <apex:pageMessages />
                                       <div class="row">
                                            <div class="col-sm-12">
                                                <div class="flex-row-copy">
                                                <div style="display:none;"><label for="{!$Component.strengthWeakness}">Strength Weakness</label></div> <!-- Accessibility Issues -->
                                                  <apex:inputTextArea id="strengthWeakness" rendered="{!proj != NULL}" value="{!proj.Strength_Weakness__c}" styleClass="textAreaWidth"/>
                                                </div>
                                            </div>
                                        </div>
                                    </div>

                                    <div class="modal-footer">
                                        <span id="cancelBtnDiv">
                                            <button id="cancelBtn" type="button" class="btn-bs btn-default" data-dismiss="modal">Close</button>
                                        </span>
                                        <span id="saveBtnDiv">
                                            <button type="button" class="btn-bs btn-primary" id="saveBtn" rerender="form, scriptPanel" Status="counterStatus" onclick="SaveStrengthWeakness(); return false;">Save</button>
                                        </span>
                                    </div>
                                </apex:outputPanel>
                            </div>
                        </div>
                    </div>
                </apex:outputPanel>
                <!-- Scoring Modal -->

                <div class="modal fade" id="scoringModal" role="dialog" aria-labelledby="editModalLabel" style="overflow-y: auto;">
                    <div class="modal-dialog" role="document">
                        <div class="modal-content">
                            <apex:outputPanel id="modalFormScoring" styleClass="modalFormScoringCls">

                                <div class="modal-header">
                                    <b>Proposal Score</b>
                                    <button type="button" class="close" data-dismiss="modal" aria-label="Close">
                                        <span aria-hidden="true">&times;</span>
                                    </button>
                                    <h4 class="modal-title" id="editModalLabelScoring"><span style="display:none;">Heading</span> </h4>
                                </div>
                                <div class="modal-body">
                                    <div class="alert alert-danger" id="validationErrorMessage"></div>
                                    <apex:pageMessages />

                                   <!-- Proposal Info -->
                                   <div class="form-group">
                                       <label for="{!$Component.modalPropNum}">Proposal Number</label>
                                       <apex:inputText id="modalPropNum" disabled="true" styleClass="form-control projectTitle" value="{!selectedProposerNumber}" html-aria-label="{!If(proj.Concept_Paper__c, 'Concept Paper', 'Proposal')} Name"/>
                                   </div>
                                   <div class="form-group">
                                      <label for="{!$Component.modalPropName}">Proposer Name</label>
                                      <apex:inputText id="modalPropName" disabled="true" styleClass="form-control projectTitle" value="{!selectedProposerName}" html-aria-label="{!If(proj.Concept_Paper__c, 'Concept Paper', 'Proposal')} Title"/>
                                   </div>
                                   <div class="form-group">
                                       <label for="{!$Component.modalPropTitle}">Proposal Title</label>
                                       <apex:inputText id="modalPropTitle" disabled="true" styleClass="form-control projectTitle" value="{!proj.Name}" html-aria-label="{!If(proj.Concept_Paper__c, 'Concept Paper', 'Proposal')} Title"/>
                                   </div>
                                  <!-- Proposal Info -->

                                    <apex:outputPanel rendered="{!NOT(ISNULL(selectedScoringMember))}">
                                    <div class="form-group">
                                        <label for="{!$Component.scoringMember}">Scoring Committee Member</label>
                                        <apex:selectList id="scoringMember" value="{!selectedScoringMember}" size="1" multiselect="false" styleClass="form-control input-sm scoringMember" onChange="fetchSelectedScorerJS();">
                                            <apex:selectOptions value="{!scoringMembers}"/>
                                        </apex:selectList>
                                        <!-- /.field -->
                                    </div>
                                    </apex:outputPanel>
                                    <div class="form-group">
                                         <label for="{!$Component.score}">Score</label>
                                        <apex:outputPanel rendered="{!AND(allowResultUpdate, ISNULL(selectedScoringMember))}">
                                            <apex:inputField value="{!proposalScoring.Score__c}" html-aria-labelledby="Score" id="score" styleClass="form-control score" onKeyDown="scoreNumberOnly(event);" html-maxlength="16"/>
                                        </apex:outputPanel>
                                        <apex:outputPanel rendered="{!OR(!allowResultUpdate, NOT(ISNULL(selectedScoringMember)))}">
                                            <apex:outputText styleClass="form-control" value="{!proposalScoring.Score__c}"/>
                                        </apex:outputPanel>
                                        <!-- /.field -->
                                    </div>
                                    <div class="form-group">
                                       <label for="{!$Component.recuse}">Recuse?</label>
                                        <apex:outputPanel rendered="{!AND(allowResultUpdate, ISNULL(selectedScoringMember))}">
                                            <apex:inputField value="{!proposalScoring.Recuse__c}" html-aria-labelledby="Recuse?" id="recuse" styleClass="form-control recuse" onKeyDown="scoreNumberOnly(event);"/>
                                        </apex:outputPanel>
                                        <apex:outputPanel rendered="{!OR(!allowResultUpdate, NOT(ISNULL(selectedScoringMember)))}">
                                            <apex:outputText styleClass="form-control" value="{!proposalScoring.Recuse__c}"/>
                                        </apex:outputPanel>
                                        <!-- /.field -->
                                    </div>
                                    <div class="form-group">
                                       <label for="{!$Component.proposalStrengthTxtArea}">Strengths</label>
                                        <apex:outputPanel rendered="{!AND(allowResultUpdate, ISNULL(selectedScoringMember))}">
                                             <apex:inputtextArea id="proposalStrengthTxtArea" html-aria-labelledby="Strengths" styleClass="mailBodyClass" value="{!proposalScoring.Strengths__c}"/>
                                        </apex:outputPanel>
                                        <apex:outputPanel rendered="{!OR(!allowResultUpdate, NOT(ISNULL(selectedScoringMember)))}">
                                            <apex:outputText escape="false" styleClass="form-control textareabox" value="{!proposalScoring.Strengths__c}"/>
                                        </apex:outputPanel>
                                        <!-- /.field -->
                                    </div>
                                    <div class="form-group">
                                     <label for="{!$Component.proposalWeaknessTxtArea}">Weaknesses</label>
                                        <apex:outputPanel rendered="{!AND(allowResultUpdate, ISNULL(selectedScoringMember))}">
                                             <apex:inputtextArea id="proposalWeaknessTxtArea" html-aria-labelledby="Weaknesses" styleClass="mailBodyClass" value="{!proposalScoring.Weaknesses__c}"/>
                                        </apex:outputPanel>
                                        <apex:outputPanel rendered="{!OR(!allowResultUpdate, NOT(ISNULL(selectedScoringMember)))}">
                                            <apex:outputText escape="false" value="{!proposalScoring.Weaknesses__c}" styleClass="form-control textareabox" />
                                        </apex:outputPanel>
                                        <!-- /.field -->
                                    </div>
                                </div>

                                <div class="modal-footer">
                                    <span id="cancelBtnDivScoring">
                                        <button id="scoringCancelBtn" type="button" class="btn-bs btn-default" data-dismiss="modal" onclick="cancelScoring(); return false;">Close</button>
                                    </span>
                                    <span id="saveBtnDivScoring">
                                        <button type="button" style="{!IF(AND(allowResultUpdate, ISNULL(selectedScoringMember)),'','display:none;')}" class="btn-bs btn-primary" id="scoringSaveBtn" onclick="SaveScoringProposalJS(); return false;">Save</button>
                                    </span>
                                </div>
                            </apex:outputPanel>
                        </div>
                    </div>
                </div>


                <!-- Matrix Scoring Modal -->
                <div class="modal fade" id="matrixScoringModal" role="dialog" aria-labelledby="editModalLabel">
                    <div class="modal-dialog modal-dialog-matrix" role="document">
                        <div class="modal-content">
                            <apex:outputPanel id="modalFormMatrixScoring" styleClass="modalFormMatrixScoringCls">

                                <div class="modal-header">
                                    <b>Score Matrix</b>
                                    <button type="button" class="close" data-dismiss="modal" aria-label="Close">
                                        <span aria-hidden="true">&times;</span>
                                    </button>
                                    <h4 class="modal-title" id="editModalLabelScoring"><span style="display:none;">Heading</span> </h4>
                                </div>
                                <div class="modal-body">
                                    <div class="alert alert-success" id="validationSuccessMessage"></div>
                                     <apex:pageMessages />
                                     <div class="panel-group" id="DeliverableGroup" role="tablist" aria-multiselectable="true">
                                        <div class="downloadLink">
                                            <apex:commandLink id="exportResult" action="{!exportResults}" reRender="">
                                                Download
                                            </apex:commandLink>
                                        </div>

                                         <apex:outputPanel rendered="{!currentSolicitation.Score_Type__c == 'Batch Rank'}" styleClass="fixed-content">
                                            <apex:variable value="{!1}" var="rowNum" />
                                            <apex:repeat value="{!proposalScoreMatrixMap}" var="grp">
                                                <div class="panel panel-nys">
                                                    <div class="panel-heading has-rollup" role="tab" id="headingGroupSection{!grp}">
                                                        <a id="GroupSection{!grp}" class="toggle-button collapsed" role="button" data-toggle="collapse" href="#{!grp}" aria-expanded="true" aria-controls="GroupSection{!grp}">
                                                            <span class="panel-title groupNameTitle">{!solicitationGrpMap[grp]}</span>
                                                            <span class="icm"></span>
                                                        </a>
                                                    </div>

                                                    <div id="{!grp}" class="panel-collapse collapse" role="tabpanel" aria-labelledby="headingGroupSection{!grp}">
                                                        <div class="panel-body">
                                                            <table id="matrixTable{!rowNum}" class="table table-condensed table-striped table-default upper table-bordered fixed-content" cellspacing="0">
                                                                <thead>
                                                                    <tr>
                                                                        <th>Proposal Number</th>
                                                                        <th style="width:200px;">Proposal</th>
                                                                        <th class="add-sort" onclick="sortTable('{!rowNum}', 1);">Avg<i class="sorting-icon fa fa-sort tbl{!rowNum}"></i></th>
                                                                        <th>Majority</th>
                                                                        <apex:repeat value="{!grpToGrpMemberMap[grp]}" var="team">
                                                                            <th>{!team.Solicitation_Review_Team__r.Member__r.Name }</th>
                                                                        </apex:repeat>

                                                                    </tr>
                                                                </thead>
                                                                <tbody>
                                                                    <apex:repeat value="{!proposalScoreMatrixMap[grp]}" var="scoreMatrix">
                                                                        <tr>
                                                                            <td>{!scoreMatrix.project.Proposal_Number__c}</td>
                                                                            <td>{!scoreMatrix.project.Name}</td>
                                                                            <td style="width: 70px;">
                                                                                <apex:outputText value="{0, number, 00.##}">
                                                                                      <apex:param value="{!scoreMatrix.project.Proposal_Average_Score__c}" />
                                                                                </apex:outputText>
                                                                            </td>
                                                                            <td style="width: 70px;">
                                                                                <apex:outputPanel rendered="{!isConceptPaper}" >
                                                                                    {!scoreMatrix.project.Concept_Paper_Result__c}
                                                                                </apex:outputPanel>
                                                                                <apex:outputPanel rendered="{!!isConceptPaper}" >
                                                                                    {!scoreMatrix.project.Proposal_Result__c}
                                                                                </apex:outputPanel>
                                                                            </td>
                                                                            <apex:repeat value="{!scoreMatrix.scoreList}" var="teamScore">
                                                                                <td>
                                                                                    <apex:outputPanel rendered="{!AND((NOT(ISBLANK(teamScore.proposalScoreId))),!teamScore.recuse)}">
                                                                                        <apex:inputText rendered="{!IF(scoreMatrix.project.Concept_Paper__c, !scoreMatrix.project.Solicitation_Round__r.Concept_Paper_Finalize_Score__c, !scoreMatrix.project.Solicitation_Round__r.Proposal_Finalize_Score__c)}" value="{!teamScore.score}" style="width: 45px;"  onKeyDown="isNumberOnly(event, this);"/>
                                                                                        <apex:outputText rendered="{!IF(scoreMatrix.project.Concept_Paper__c, scoreMatrix.project.Solicitation_Round__r.Concept_Paper_Finalize_Score__c, scoreMatrix.project.Solicitation_Round__r.Proposal_Finalize_Score__c)}"
                                                                                            value="{0, number, 0.##}">
                                                                                            <apex:param value="{!teamScore.score}" />
                                                                                         </apex:outputText>
                                                                                    </apex:outputPanel>
                                                                                    <apex:outputPanel rendered="{!teamScore.recuse}">
                                                                                        R
                                                                                    </apex:outputPanel>
                                                                                </td>
                                                                            </apex:repeat>

                                                                        </tr>
                                                                     </apex:repeat>
                                                                </tbody>
                                                            </table>
                                                        </div>
                                                    </div>

                                                </div>
                                                <apex:variable var="rowNum" value="{!rowNum + 1}"/>
                                            </apex:repeat>
                                         </apex:outputPanel>

                                          <apex:outputPanel rendered="{!currentSolicitation.Score_Type__c != 'Batch Rank'}" styleClass="fixed-content">
                                            <apex:variable value="{!1}" var="rowNum" />
                                             <table id="matrixTable{!rowNum}" class="table table-condensed table-striped table-default upper table-bordered" cellspacing="0">
                                                  <thead>
                                                      <tr>
                                                          <th>Proposal Number</th>
                                                          <th style="width:200px;">Proposal</th>
                                                          <th class="add-sort" onclick="sortTable('{!rowNum}', 1);">Avg<i class="sorting-icon fa fa-sort tbl{!rowNum}"></i></th>
                                                          <th>Majority</th>
                                                           <apex:repeat value="{!reviewTeam}" var="team">
                                                               <th>{!team.Member__r.Name }</th>
                                                           </apex:repeat>

                                                      </tr>
                                                  </thead>
                                                  <tbody>
                                                      <apex:repeat value="{!proposalScoreMatrixMap}" var="scoreMatrix">
                                                            <apex:repeat value="{!proposalScoreMatrixMap[scoreMatrix]}" var="matrixData">
                                                                <tr>
                                                                    <td>{!matrixData.project.Proposal_Number__c}</td>
                                                                    <td>{!matrixData.project.Name}</td>
                                                                    <td style="width: 70px;">
                                                                        <apex:outputText value="{0, number, 00.##}">
                                                                              <apex:param value="{!matrixData.project.Proposal_Average_Score__c}" />
                                                                        </apex:outputText>

                                                                    </td>
                                                                    <td style="width: 70px;">
                                                                        <apex:outputPanel rendered="{!isConceptPaper}" >
                                                                            {!matrixData.project.Concept_Paper_Result__c}
                                                                         </apex:outputPanel>
                                                                         <apex:outputPanel rendered="{!!isConceptPaper}" >
                                                                            {!matrixData.project.Proposal_Result__c}
                                                                         </apex:outputPanel>
                                                                    </td>
                                                                    <apex:repeat value="{!matrixData.scoreList}" var="teamScore">
                                                                      <td>
                                                                          <apex:outputPanel rendered="{!AND((NOT(ISBLANK(teamScore.proposalScoreId))), !teamScore.recuse)}" >
                                                                            <apex:inputText rendered="{!IF(matrixData.project.Concept_Paper__c, !matrixData.project.Solicitation_Round__r.Concept_Paper_Finalize_Score__c, !matrixData.project.Solicitation_Round__r.Proposal_Finalize_Score__c)}" value="{!teamScore.score}"  style="width: 45px;" onKeyDown="isNumberOnly(event, this);"/>
                                                                            <apex:outputText rendered="{!IF(matrixData.project.Concept_Paper__c, matrixData.project.Solicitation_Round__r.Concept_Paper_Finalize_Score__c, matrixData.project.Solicitation_Round__r.Proposal_Finalize_Score__c)}"
                                                                                             value="{0, number, 0.##}" >

                                                                              <apex:param value="{!teamScore.score}"  />

                                                                            </apex:outputText>
                                                                          </apex:outputPanel>
                                                                          <apex:outputPanel rendered="{!teamScore.recuse}">
                                                                            R
                                                                          </apex:outputPanel>
                                                                      </td>
                                                                    </apex:repeat>
                                                                </tr>
                                                            </apex:repeat>
                                                       </apex:repeat>
                                                  </tbody>
                                                  <apex:variable var="rowNum" value="{!rowNum + 1}"/>
                                              </table>
                                          </apex:outputPanel>

                                    </div>
                                </div>

                                <div class="modal-footer">
                                    <span id="cancelBtnMatrixScoring">
                                        <button id="matrixScoringCancelBtn" type="button" class="btn-bs btn-default" data-dismiss="modal">Close</button>
                                    </span>
                                    <span id="saveBtnMatrixScoring">
                                        <button type="button" class="btn-bs btn-primary" id="matrixScoringSaveBtn" onclick="saveScoreMatrixJS();">Save</button>
                                    </span>
                                </div>
                            </apex:outputPanel>
                        </div>
                    </div>
                </div>

                <!-- CONFIRMATION POP UP -->
                <div class="modal fade" id="confirmationModal" role="dialog" aria-labelledby="editModalLabel">
                    <apex:outputPanel id="confirmationModalPanel">
                        <div class="modal-dialog" role="document">
                            <div class="modal-content">
                                <div class="modal-header">
                                    <b>Score Update Confirmation</b>
                                    <button type="button" class="close" data-dismiss="modal" aria-label="Close">
                                        <span aria-hidden="true">&times;</span>
                                    </button>
                                    <h4 class="modal-title" id="editModalLabelScoring"><span style="display:none;">Heading</span> </h4>
                                </div>
                                <div class="modal-body">
                                    <div class="form-group">
                                        <apex:outputPanel rendered="{!allowResultUpdate}">
                                            You have already provided the score, do you want to update the score again, click continue.
                                        </apex:outputPanel>
                                        <apex:outputPanel rendered="{!!allowResultUpdate}">
                                            We are unable to make changes to proposal scores at this time.
                                        </apex:outputPanel>

                                    </div>
                                </div>

                                <div class="modal-footer">
                                    <span id="cancelBtnDivScoring">
                                        <button id="scoringCancelBtn" type="button" class="btn-bs btn-default" data-dismiss="modal">Close</button>
                                    </span>
                                    <apex:outputPanel rendered="{!allowResultUpdate}" layout="none">
                                        <span id="saveBtnDivScoring">
                                            <button type="button" class="btn-bs btn-primary" id="scoringSaveBtn" onclick="scoringOpenModal(); return false;">Continue</button>
                                        </span>
                                    </apex:outputPanel>
                                </div>
                            </div>
                        </div>
                    </apex:outputPanel>
                </div>


                <!-- GROUP Delete CONFIRMATION POP UP -->
                <div class="modal fade" id="confirmationModal1" role="dialog" aria-labelledby="editModalLabel">
                    <div class="modal-dialog" role="document">
                        <div class="modal-content">
                            <div class="modal-header">
                                <b>Group Delete Confirmation</b>
                                <button type="button" class="close" data-dismiss="modal" aria-label="Close">
                                    <span aria-hidden="true">&times;</span>
                                </button>
                                <h4 class="modal-title" id="editModalLabelScoring"><span style="display:none;">Heading</span>  </h4>
                            </div>
                            <div class="modal-body">
                                <div class="form-group">
                                    Are you sure you want to delete this group? Please note that this cannot be undone once confirmed.
                                </div>
                            </div>

                            <div class="modal-footer">
                                <span id="saveBtnDivScoring">
                                    <button type="button" class="btn-bs btn-primary" id="scoringSaveBtn" onclick="deleteGroup(); return false;">Yes</button>
                                </span>
                                <span id="cancelBtnDivScoring">
                                    <button id="scoringCancelBtn" type="button" class="btn-bs btn-default" data-dismiss="modal">No</button>
                                </span>
                            </div>
                        </div>
                    </div>
                </div>


                <!-- Score Finalization -->
                <div class="modal fade" id="scoreFinalizeConfirmation" role="dialog" aria-labelledby="editModalLabel">
                    <div class="modal-dialog" role="document">
                        <div class="modal-content">
                            <div class="modal-header">
                                <b>Finalize Score</b>
                                <button type="button" class="close" data-dismiss="modal" aria-label="Close">
                                    <span aria-hidden="true">&times;</span>
                                </button>
                                <h4 class="modal-title" id="editModalLabelScoring"> <span style="display:none;">Heading</span> </h4>
                            </div>
                            <div class="modal-body">
                                <div class="form-group">
                                    There are Review Team members that have not submitted their scores. Are you sure you'd like to finalize?
                                </div>
                            </div>

                            <div class="modal-footer">
                                <span id="saveBtnDivFinalizeScoring">
                                    <button type="button" class="btn-bs btn-primary" id="finalizeScoringSaveBtn" onclick="finalizeScore(); return false;">Continue</button>
                                </span>
                                <span id="cancelBtnDivScoring">
                                    <button id="finalizeScoringCancelBtn" type="button" class="btn-bs btn-default" data-dismiss="modal">Cancel</button>
                                </span>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- START : Show More Pop Up for Strength Field -->
                <div class="modal fade" id="showMoreModal" role="dialog" aria-labelledby="editModalLabel">
                    <div class="modal-dialog" role="document">
                        <div class="modal-content">
                            <div class="modal-header">
                                <b>
                                    <span id="headerName"></span>
                                </b>
                                <button type="button" class="close" data-dismiss="modal" aria-label="Close">
                                    <span aria-hidden="true">&times;</span>
                                </button>
                                <h4 class="modal-title" id="editModalLabelScoring"> <span style="display:none;">Heading</span> </h4>
                            </div>
                            <div class="modal-body">
                                <div class="form-group showMoreDiv text-justify">

                                </div>
                            </div>

                            <div class="modal-footer">
                                <span id="cancelBtnDivScoring">
                                    <button id="cancelBtn" type="button" class="btn-bs btn-default" data-dismiss="modal">Close</button>
                                </span>
                            </div>
                        </div>
                    </div>
                </div>
                <!-- FINISH : Show More Pop Up for Strength Field -->


                <!-- START : Show More Pop Up for Strength Field -->
                <div class="modal fade" id="statusChangeConfirmationModal" role="dialog" aria-labelledby="editModalLabel">
                    <div class="modal-dialog" role="document">
                        <div class="modal-content">
                            <div class="modal-header">
                                <b>Confirmation Message</b>
                                <button type="button" class="close" data-dismiss="modal" aria-label="Close">
                                    <span aria-hidden="true">&times;</span>
                                </button>
                                <h4 class="modal-title" id="editModalLabelScoring"> <span style="display:none;">Heading</span> </h4>
                            </div>
                            <div class="modal-body">
                                <div class="form-group statusDiv text-justify">

                                </div>
                            </div>

                            <div class="modal-footer">
                                <span id="cancelBtnDivScoring">
                                    <button id="cancelBtn" type="button" class="btn-bs btn-default" data-dismiss="modal">Close</button>
                                </span>
                                <span id="cancelBtnDivScoring">
                                    <button id="cancelBtn" type="button" class="btn-bs btn-primary" onclick="saveProposals()">Save</button>
                                </span>
                            </div>
                        </div>
                    </div>
                </div>
                <!-- FINISH : Show More Pop Up for Strength Field -->


                <!-- START : Show confirmation when Director/Green-light Approval is changed -->
                <div class="modal fade" id="greenlightChangeConfirmationModal" role="dialog" aria-labelledby="editModalLabel">
                    <div class="modal-dialog" role="document">
                        <div class="modal-content">
                            <div class="modal-header">
                                <b>Confirmation Message</b>
                                <button type="button" class="close" data-dismiss="modal" aria-label="Close">
                                    <span aria-hidden="true">&times;</span>
                                </button>
                                <h4 class="modal-title" id="editModalLabelScoringDirector"> <span style="display:none;">Heading</span> </h4>
                            </div>
                            <div class="modal-body">
                                <div class="form-group statusDivGreenlight text-justify">

                                </div>
                            </div>

                            <div class="modal-footer">
                                <span id="cancelBtnDivScoring">
                                    <button id="cancelBtn" type="button" class="btn-bs btn-default" data-dismiss="modal">No</button>
                                </span>
                                <span id="cancelBtnDivScoring">
                                    <button id="cancelBtn" type="button" class="btn-bs btn-primary" onclick="openConfirmationMessage()">Yes</button>
                                </span>
                            </div>
                        </div>
                    </div>
                </div>
                <!-- FINISH : Show confirmation when Director/Greenlight Approval is changed -->

            <!-- START : POP UP TO SHOW NOTIFICATION PREVIEW -->
                <div class="modal fade" id="previewNotification" role="dialog" aria-labelledby="editModalLabel">
                    <apex:outputPanel id="previewNotificationModalPanel">
                        <div class="modal-dialog" role="document">
                            <div class="modal-content">
                                <div class="modal-header">
                                    <b>Notification Preview</b>
                                    <button type="button" class="close" data-dismiss="modal" aria-label="Close">
                                        <span aria-hidden="true">&times;</span>
                                    </button>
                                </div>
                                <div class="modal-body">
                                    <div class="form-group">
                    <div class="flex-row">
                      <div class="col-sm-4">
                        {!If(isConceptPaper, 'Director Approval', 'Greenlight Approval')}
                      </div>
                      <div class="col-sm-4">
                        <apex:inputField styleClass="input-sm form-control w140 recommendation recommendationNotification" value="{!objProj.Recommendation__c}" />
                      </div>
                      <div class="col-sm-2">
                        <button id="goButton" type="button" class="btn-bs btn-default" onclick="fetchNotification();">Go</button>
                      </div>
                    </div>
                    <div class="flex-row text-justify notificationBodyDiv">
                      <apex:outputPanel id="notificationBody">
                        <apex:outputPanel rendered="{!AND(previewEmailBody != null, previewEmailBody != '')}">
                          <div>
                            <label>Subject:</label>
                          </div>
                          <div>
                            <apex:outputText value="{!previewEmailSubject}" escape="false" />
                          </div>
                          <div class="col-sm-12"> &nbsp; </div>
                          <div>
                            <label>Body:</label>
                          </div>
                          <div>
                            <apex:outputText value="{!previewEmailBody}" escape="false"/>
                          </div>
                        </apex:outputPanel>
                        <apex:outputPanel rendered="{!OR(previewEmailBody == null, previewEmailBody == '')}">
                          No preview available.
                        </apex:outputPanel>
                      </apex:outputPanel>
                    </div>
                    </div>
                      </div>
                         <div class="modal-footer">
                           <span id="cancelBtnDivScoring">
                               <button id="scoringCancelBtn" type="button" class="btn-bs btn-default" data-dismiss="modal">Close</button>
                           </span>
                         </div>
                       </div>
                      </div>
                    </apex:outputPanel>
                </div>

                <!-- START : Manage Group Pop up -->
                <div class="modal fade" id="manageGroupModal" role="dialog" aria-labelledby="editModalLabel">
                    <div class="modal-dialog modal-dialog-matrix" role="document">
                        <div class="modal-content">
                            <apex:outputPanel id="modalForManageGroup" styleClass="modalForManageGroupCls">
                                <div class="modal-header">
                                    <b>Manage Group</b>
                                    <button type="button" class="close" onclick="refreshMainTableJS()" aria-label="Close">
                                        <span aria-hidden="true">&times;</span>
                                    </button>
                                </div>
                                <div class="modal-body">
                                    <apex:pageMessages />
                                    <apex:outputPanel id="errorPanel" >
                                        <apex:outputPanel rendered="{!hasErrorWhileDeletingMember}" >
                                            <div class="alert alert-danger">
                                                <strong>Error! This member cannot be removed because scoring is in progress.</strong>
                                            </div>
                                        </apex:outputPanel>
                                        <apex:outputPanel rendered="{!hasErrorWhileDeletingGroup}" >
                                            <div class="alert alert-danger">
                                                <strong>Error! This group cannot be deleted because scoring is in progress.</strong>
                                            </div>
                                        </apex:outputPanel>
                                        <apex:outputPanel rendered="{!hasNoMemberToAddInGroup}" >
                                            <div class="alert alert-danger">
                                                <strong>There are no members available to add to this group.</strong>
                                            </div>
                                        </apex:outputPanel>
                                    </apex:outputPanel>


                                    <div class="panel-group" id="DeliverableGroup" role="tablist" aria-multiselectable="true">
                                        <div class="table-controls reset">
                                            <apex:outputPanel >
                                                <a href="#" onclick="allowSolicitationGroupCreation();" class="add-button">New group</a>
                                            </apex:outputPanel>
                                        </div>

                                        <apex:outputPanel id="createGroupPanel">
                                            <div class="table-controls reset">
                                                <apex:outputPanel rendered="{!allowGrpCreation}">
                                                    <div class="row margin_15_0_5_15">
                                                        <div class="col-sm-6">
                                                            <div class="flex-row mt2">
                                                                <Label for="{!$Component.gName}">Group Name:</Label>
                                                                <div class="field">
                                                                <apex:inputField styleClass="form-control input-sm" id="gName" value="{!solicitationGrp.Name}"/>
                                                                </div>
                                                            </div>
                                                        </div>
                                                        <div class="col-sm-2">
                                                            <button type="button" class="btn-bs btn-primary" id="saveBtn" onclick="saveSolicitationGroup();">Save</button>
                                                        </div>
                                                        <div class="col-sm-2">
                                                            <button id="cancelBtn" type="button" class="btn-bs btn-default ml25" onclick="cancelGroupCreation();">Cancel</button>
                                                        </div>
                                                    </div>
                                                </apex:outputPanel>
                                            </div>
                                        </apex:outputPanel>

                                        <apex:outputPanel id="groupTable">
                                            <apex:repeat value="{!solicitationGroupList}" var="groupRec">
                                                <div class="panel panel-nys">
                                                    <div class="panel-heading has-rollup" role="tab" id="headingGroupSection{!groupRec.id}">
                                                        <a id="GroupSection{!groupRec.id}" class="toggle-button collapsed" role="button" data-toggle="collapse" href="#{!groupRec.id}" aria-expanded="true" aria-controls="GroupSection{!groupRec.id}">
                                                            <span class="panel-title groupNameTitle">{!groupRec.groupName}</span>

                                                            <span class="total">
                                                                <span class="name">Total Members: </span>
                                                                <span>{!groupRec.totalMembers} </span>
                                                            </span>
                                                            <span class="icm"></span>
                                                        </a>
                                                        <div id="editDiv{!groupRec.id}" class="hidden">
                                                            <span class="total edit-div-input">
                                                                <apex:inputText value="{!groupRec.groupName}" html-aria-label="groupName" styleClass="form-control groupEditedName{!groupRec.id}" style="height: 25px;"/>
                                                            </span>
                                                            <!-- <span class="total">
                                                                <button type="button" class="btn-bs btn-primary" id="saveBtn" onclick="addNewMemberToGroup('{!groupRec.Id}')">Save</button>
                                                                <button id="cancelBtn" type="button" class="btn-bs btn-default ml25" onclick="resetGroupMemberList();">Cancel</button>
                                                            </span> -->
                                                        </div>

                                                        <span class="total link_style_manage_group" id="GroupSection1{!groupRec.id}">
                                                           <div onclick="openEditBox('{!groupRec.Id}')">Edit </div>
                                                           <div>&nbsp;|&nbsp; </div>
                                                           <div onclick="openGroupDelConfirmationPopup('{!groupRec.Id}')">Delete</div>
                                                       </span>
                                                       <span class="total link_style_manage_group hidden" id="editDiv1{!groupRec.id}">
                                                           <div class="editGrpPanel" onclick="saveGroup('{!groupRec.Id}')">Save </div>
                                                           <div>&nbsp;|&nbsp; </div>
                                                           <div onclick="closeEditBox('{!groupRec.Id}')">Cancel</div>
                                                       </span>
                                                    </div>

                                                    <div id="{!groupRec.id}" class="panel-collapse collapse" role="tabpanel" aria-labelledby="headingGroupSection{!groupRec.id}">
                                                        <div class="panel-body">
                                                            <apex:outputPanel id="groupMemberTable">
                                                                <apex:outputPanel rendered="{!groupRec.groupMemberList.size > 0}" layout="none" >
                                                                    <table id="contactTable" class="table-condensed table-striped table-default upper table-bordered" cellspacing="0" width="60%">
                                                                        <thead>
                                                                            <tr>
                                                                                <th>Name</th>
                                                                                <th class="text-center">External?</th>
                                                                                <th class="text-center">Action</th>
                                                                            </tr>
                                                                        </thead>
                                                                        <tbody>
                                                                            <apex:variable var="i" value="{!0}" />
                                                                            <apex:repeat value="{!groupRec.groupMemberList}" var="groupMember">
                                                                                <apex:variable var="i" value="{!i+1}" />
                                                                                <tr>
                                                                                    <td>{!groupMember.memberName}</td>
                                                                                    <td class="text-center">
                                                                                        <!-- {!groupMember.isExternal} -->
                                                                                        <apex:image alt="checkbox" URL="{!if(groupMember.isExternal,'/img/checkbox_checked.gif','/img/checkbox_unchecked.gif')}"/>
                                                                                    </td>
                                                                                    <td class="text-center">
                                                                                        <apex:outputPanel rendered="{!!groupMember.isSolicitationManager}">
                                                                                            <a onclick="openGroupMemberDelConfirmationPopup('{!groupMember.Id}', '{!groupRec.Id}')" class="actionLink">Remove</a>
                                                                                        </apex:outputPanel>
                                                                                    </td>
                                                                                </tr>
                                                                            </apex:repeat>
                                                                        </tbody>
                                                                    </table>
                                                                </apex:outputPanel>
                                                            </apex:outputPanel>
                                                            <div class="table-controls reset">
                                                                <apex:outputPanel >
                                                                    <a href="#" onclick="getGroupMemberList('{!groupRec.Id}');" class="add-button">Add member to this group</a>
                                                                </apex:outputPanel>
                                                            </div>

                                                            <div id="addNewMemberDiv{!groupRec.Id}">
                                                                <apex:outputPanel id="newGroupMember">
                                                                    <apex:outputPanel rendered="{!AND(reviewTeamMemberList.size > 0, groupRec.id == selectedGroupId)}">
                                                                        <div class="row margin_15_0_5_15">
                                                                            <div class="col-sm-5">
                                                                                <apex:selectList styleClass="form-control input-sm" size="1" multiselect="false" value="{!selectedReviewTeamId}">
                                                                                    <apex:selectOptions value="{!reviewTeamMemberList}"/>
                                                                                </apex:selectList>
                                                                            </div>
                                                                            <div class="col-sm-1">
                                                                                <button type="button" class="btn-bs btn-primary" id="saveBtn" onclick="addNewMemberToGroup('{!groupRec.Id}')">Save</button>
                                                                            </div>
                                                                            <div class="col-sm-1">
                                                                                <button id="cancelBtn" type="button" class="btn-bs btn-default ml25" onclick="resetGroupMemberList();">Cancel</button>
                                                                            </div>
                                                                        </div>
                                                                    </apex:outputPanel>
                                                                </apex:outputPanel>
                                                            </div>
                                                        </div>
                                                    </div>
                                                </div>
                                            </apex:repeat>
                                        </apex:outputPanel>
                                    </div>
                                </div>

                                <div class="modal-footer">
                                    <span id="cancelBtnManageGroup">
                                        <button id="manageGroupCancelBtn" type="button" class="btn-bs btn-default" onclick="refreshMainTableJS()">Close</button>
                                    </span>
                                </div>
                            </apex:outputPanel>
                        </div>
                    </div>
                </div>
                <!-- END : Manage Group Pop up -->


                <!-- START: Project Review Information Pop Up -->
                <div class="modal fade" id="projectReviewModal" role="dialog" aria-labelledby="editModalLabel">
                    <div class="modal-dialog modal-dialog-matrix" role="document">
                        <div class="modal-content">
                            <apex:outputPanel id="modalFormProjectReview" styleClass="modalFormProjectReviewCls">
                                <div class="modal-header">
                                    <b>Proposal/Concept Paper Review Information</b>
                                    <button type="button" class="close" data-dismiss="modal" aria-label="Close">
                                        <span aria-hidden="true">&times;</span>
                                    </button>
                                    <h4 class="modal-title" id="editModalLabelScoring"><span style="display:none;">Heading</span> </h4>
                                </div>
                                <div class="modal-body">
                                    <div class="alert alert-success" id="validationProjReviewSuccessMessage"></div>
                                    <apex:pageMessages />
                                    <apex:outputPanel rendered="{!allowUpdate}">
                                        <div class="panel panel-nys pb3">
                                          <div class="panel-heading has-rollup">
                                            <a class="toggle-button collapsed" role="button" data-toggle="collapse" href="#impacts" aria-expanded="true" >
                                              <span class="panel-title">Impacts / Benefits </span>
                                              <span class="icm"></span>
                                            </a>
                                        </div>
                                        </div>
                                        <div class="panel-collapse collapse" id="impacts">
                                            <apex:inputtextArea id="impactTxtArea" styleClass="mailBodyClass" value="{!proj.Impacts_Benefits__c}"/>
                                        </div>

                                        <div class="panel panel-nys pb3">
                                          <div class="panel-heading has-rollup">
                                            <a class="toggle-button collapsed" role="button" data-toggle="collapse" href="#proposalStrengths" aria-expanded="true" >
                                              <span class="panel-title">Proposal Strengths</span>
                                              <span class="icm"></span>
                                            </a>
                                        </div>
                                        </div>
                                        <div class="panel-collapse collapse" id="proposalStrengths">
                                          <apex:inputtextArea id="strengthTxtArea" styleClass="mailBodyClass" value="{!proj.Proposal_Strengths__c}"/>
                                        </div>

                                        <div class="panel panel-nys pb3">
                                          <div class="panel-heading has-rollup">
                                            <a class="toggle-button collapsed" role="button" data-toggle="collapse" href="#proposalWeakness" aria-expanded="true" >
                                              <span class="panel-title">Proposal Weaknesses</span>
                                              <span class="icm"></span>
                                            </a>
                                        </div>
                                        </div>
                                        <div class="panel-collapse collapse" id="proposalWeakness">
                                          <apex:inputtextArea id="weaknessTxtArea" styleClass="mailBodyClass" value="{!proj.Proposal_Weaknesses__c}"/>
                                        </div>

                                        <div class="panel panel-nys pb3">
                                          <div class="panel-heading has-rollup">
                                            <a class="toggle-button collapsed" role="button" data-toggle="collapse" href="#proposalRisk" aria-expanded="true" >
                                              <span class="panel-title">Proposal Risks</span>
                                              <span class="icm"></span>
                                            </a>
                                        </div>
                                        </div>
                                        <div class="panel-collapse collapse" id="proposalRisk">
                                            <apex:inputtextArea id="riskTxtArea" styleClass="mailBodyClass" value="{!proj.Proposal_Risks__c}"/>
                                        </div>

                                        <div class="panel panel-nys pb3">
                                          <div class="panel-heading has-rollup">
                                            <a class="toggle-button collapsed" role="button" data-toggle="collapse" href="#contingencies" aria-expanded="true" >
                                              <span class="panel-title">Contingencies / Recommendations</span>
                                              <span class="icm"></span>
                                            </a>
                                        </div>
                                        </div>
                                        <div class="panel-collapse collapse" id="contingencies">
                                            <apex:inputtextArea id="contingenciesTxtArea" styleClass="mailBodyClass" value="{!proj.Contingencies_Recommendations__c}"/>
                                        </div>

                                        <div class="panel panel-nys pb3">
                                          <div class="panel-heading has-rollup">
                                            <a class="toggle-button collapsed" role="button" data-toggle="collapse" href="#synopsis" aria-expanded="true" >
                                              <span class="panel-title">Synopsis</span>
                                              <span class="icm"></span>
                                            </a>
                                        </div>
                                        </div>
                                        <div class="panel-collapse collapse" id="synopsis">
                                             <apex:inputtextArea id="synopsisTxtArea" styleClass="mailBodyClass" value="{!proj.Synopsis__c}"/>
                                        </div>

                                        <div class="panel panel-nys pb3">
                                          <div class="panel-heading has-rollup">
                                            <a class="toggle-button collapsed" role="button" data-toggle="collapse" href="#additionalInfo" aria-expanded="true" >
                                              <span class="panel-title">Additional Information for Award Letter</span>
                                              <span class="icm"></span>
                                            </a>
                                        </div>
                                        </div>
                                        <div class="panel-collapse collapse" id="additionalInfo">
                                            <apex:inputTextarea rows="5" id="addInfoAwardTxtArea" styleClass="mailBodyClass w100percent" value="{!proj.Additional_Information_for_Award_Letter__c}"/>
                                        </div>

                                  </apex:outputPanel>
                                </div>

                                <div class="modal-footer">
                                    <span id="cancelBtnMatrixScoring">
                                        <button id="projectReviewCancelBtn" type="button" class="btn-bs btn-default" data-dismiss="modal">Close</button>
                                    </span>
                                    <span id="saveBtnMatrixScoring">
                                        <button type="button" class="btn-bs btn-primary" id="projectReviewSaveBtn" onclick="saveProjectReviewInformationJS(); return false;">Save</button>
                                    </span>
                                </div>
                            </apex:outputPanel>
                        </div>
                    </div>
                </div>
                <!-- END: Project Review Information Pop Up -->


               <apex:actionFunction name="saveRecords" action="{!saveRecords}" rerender="form, scriptPanel" Status="counterStatus" oncomplete="disabledPicklist();updateReccPicklistVal('{!isConceptPaper}');manageUI();greenlightValueChangedReset('{!greenlightValueChanged}','{!isConceptPaper}');" />

                <apex:actionFunction name="insertFunds" action="{!insertFunds}" rerender="form, scriptPanel" Status="counterStatus" oncomplete="$('.successMessage').hide();disabledPicklist();updateReccPicklistVal('{!isConceptPaper}');manageUI();greenlightValueChangedReset('{!greenlightValueChanged}','{!isConceptPaper}');">
                    <apex:param name="selectedIndex" value="" assignTo="{!selectedIndex}"/>
                </apex:actionFunction>

                <apex:actionFunction name="sortData" action="{!startRetrieval}" rerender="form, scriptPanel" status="counterStatus" oncomplete="disabledPicklist();updateReccPicklistVal('{!isConceptPaper}');manageUI();greenlightValueChangedReset('{!greenlightValueChanged}','{!isConceptPaper}');">
                    <apex:param name="sortFieldName" value="" assignTo="{!sortFieldName}"/>
                    <apex:param name="isSortingChanged" value="true" assignTo="{!isSortingChanged}"/>
                </apex:actionFunction>

                <apex:actionFunction name="SaveStrengthWeakness" action="{!saveStrengthWeakness}"  oncomplete="closeModal(); manageUI(); greenlightValueChangedReset('{!greenlightValueChanged}','{!isConceptPaper}'); return false;"/>
                <apex:actionFunction name="saveProjectReviewInformation" action="{!saveProjectReviewInformation}"
                                     rerender="modalFormProjectReview, mainTable, scriptPanel"  Status="counterStatus"
                                     oncomplete="projectReviewShowMessage('{!isProjectReviewInfoSaved}'); updateReccPicklistVal('{!isConceptPaper}'); manageUI(); greenlightValueChangedReset('{!greenlightValueChanged}','{!isConceptPaper}'); return false;">
                    <apex:param name="impact" value="" assignTo="{!proj.Impacts_Benefits__c}"/>
                    <apex:param name="strength" value="" assignTo="{!proj.Proposal_Strengths__c}"/>
                    <apex:param name="weakness" value="" assignTo="{!proj.Proposal_Weaknesses__c}"/>
                    <apex:param name="risk" value="" assignTo="{!proj.Proposal_Risks__c}"/>
                    <apex:param name="contingencies" value="" assignTo="{!proj.Contingencies_Recommendations__c}"/>
                    <apex:param name="synopsis" value="" assignTo="{!proj.Synopsis__c}"/>
                    <apex:param name="additionalInfoAward" value="" assignTo="{!proj.Additional_Information_for_Award_Letter__c}"/>
                </apex:actionFunction>

                <apex:actionFunction name="SaveScoringProposal" action="{!saveProposalScoring}"
                                     rerender="mainTable, scriptPanel" Status="counterStatus"
                                     oncomplete="scoringCloseModal(); updateReccPicklistVal('{!isConceptPaper}');manageUI(); greenlightValueChangedReset('{!greenlightValueChanged}','{!isConceptPaper}'); return false;">
                    <apex:param name="strength" value="" assignTo="{!proposalScoring.Strengths__c}"/>
                    <apex:param name="weakness" value="" assignTo="{!proposalScoring.Weaknesses__c}"/>
                </apex:actionFunction>
                <apex:actionFunction name="cancelScoring" action="{!cancelProposalScore}" rerender="" immediate="true" oncomplete="manageUI();"/>
                <apex:actionFunction name="fetchSelectedScorer" action="{!fetchSelectedScorer}" rerender="modalFormScoring, scriptPanel" immediate="true" oncomplete="clearMessage();manageUI();">
                    <apex:param name="scorerId" value="" assignTo="{!selectedScoringMember}"/>
                </apex:actionFunction>
                <apex:actionFunction name="saveScoreMatrix" action="{!saveProposalMatrix}"  rerender="modalFormMatrixScoring, scriptPanel"  Status="counterStatus" oncomplete="showMatrixSuccessMsg('{!isMatrixUpdated}'); manageUI();"/>


                <apex:actionFunction name="finalizeScore" action="{!finalizeFinalScore}" status="counterStatus" rerender="mainTable, scriptPanel" oncomplete="closeFinalizeScoreConfirmationModal(); updateReccPicklistVal('{!isConceptPaper}');manageUI(); return false;"/>

                <apex:actionFunction name="backToSolicitation" action="{!backToSolicitation}" status="counterStatus"  />

                <apex:actionFunction name="populateSolicitationGroupList" action="{!populateSolicitationGroupList}" rerender="modalForManageGroup, errorPanel" oncomplete="openManageGroupPopup();manageUI();" status="counterStatus" />

                <apex:actionFunction name="allowSolicitationGroupCreation" action="{!allowSolicitationGroupCreation}" rerender="createGroupPanel" status="counterStatus" oncomplete="manageUI();"/>
                <apex:actionFunction name="saveSolicitationGroup" action="{!saveSolicitationGroup}" rerender="createGroupPanel, errorPanel, groupTable" status="counterStatus" oncomplete="manageUI();"/>
                <apex:actionFunction name="cancelGroupCreation" action="{!cancelGroupCreation}" rerender="createGroupPanel, groupTable" status="counterStatus" oncomplete="manageUI();"/>

                <apex:actionFunction name="deleteSolicitationGroup" action="{!deleteSolicitationGroup}" rerender="modalForManageGroup, errorPanel" status="counterStatus" oncomplete="manageUI();">
                    <apex:param name="selectedGroupId" value="" assignTo="{!selectedGroupId}"/>
                </apex:actionFunction>

                <apex:actionFunction name="addNewMemberToGroup" action="{!addNewMemberToGroup}" rerender="groupMemberTable, newGroupMember, errorPanel, groupTable" oncomplete="openSelectedGroup('{!selectedGroupId}');manageUI();" status="counterStatus">
                    <apex:param name="selectedGroupId" value="" assignTo="{!selectedGroupId}"/>
                </apex:actionFunction>

                <apex:actionFunction name="getGroupMemberList" action="{!getGroupMemberList}" rerender="newGroupMember, errorPanel" status="counterStatus" oncomplete="manageUI();">
                    <apex:param name="selectedGroupId" value="" assignTo="{!selectedGroupId}"/>
                </apex:actionFunction>

                <apex:actionFunction name="resetGroupMemberList" action="{!resetGroupMemberList}" rerender="newGroupMember, errorPanel" status="counterStatus" oncomplete="manageUI();" />

                <apex:actionFunction name="deleteSolicitationGroupMember" action="{!deleteSolicitationGroupMember}" rerender="groupMemberTable, errorPanel, groupTable" oncomplete="openSelectedGroup('{!selectedGroupId}');manageUI();" status="counterStatus">
                    <apex:param name="selectedGroupMemberId" value="" assignTo="{!selectedGroupMemberId}"/>
                    <apex:param name="selectedGroupId" value="" assignTo="{!selectedGroupId}"/>
                </apex:actionFunction>

                <apex:actionFunction name="saveGroupRec" action="{!saveGroupRec}" rerender="groupTable, errorPanel" status="counterStatus" oncomplete="closeEditBox('{!selectedGroupId}');manageUI();">
                    <apex:param name="selectedGroupId" value="" assignTo="{!selectedGroupId}"/>
                    <apex:param name="editedGroupName" value="" assignTo="{!editedGroupName}"/>
                </apex:actionFunction>

                <apex:actionFunction name="refreshMainTable" action="{!startRetrieval}" rerender="mainTable, scriptPanel" oncomplete="closeManageGroupPopup();manageUI(); greenlightValueChangedReset('{!greenlightValueChanged}','{!isConceptPaper}');" status="counterStatus" />

                <apex:actionFunction name="fetchNotification" action="{!fetchNotification}" rerender="notificationBody" status="counterStatus" />

                </apex:form>
                </div><!-- /.content -->
            </div>
        </apex:define>
    </apex:composition>

    <script>

        var greenlightValueChanged = '{!greenlightValueChanged}';
        var conceptPaperJSVar = '{!isConceptPaper}';

        function manageUI() {
            $(".filter-status option[value='']").remove();
            $('.select2').select2();
        }

        function greenlightValueChangedReset(greenlightValueChangedVal,conceptPaperJSVarVal) {
          greenlightValueChanged = greenlightValueChangedVal;
          conceptPaperJSVar = conceptPaperJSVarVal;
        }

        $(document).ready(function() {
            hideExtraCharacters();
            manageApprovalDropDown();
            manageUI();
            setTimeout(function() {
                manageTable();
            }, 400);
        });

        function manageTable() {
          $("#reviewTable-header thead").remove(); // Remove Previous thead of header table.

          $table = $("#reviewTable-header");
          var thead = $("#reviewTable thead");
          var clone = thead.clone();
          $table.append(clone); // add new row to end of table
      $table.width($("#reviewTable").width()); //To set Dynamic width of table
          $('.tableDiv').on('scroll', function(){
            $table.css('top', $(this).scrollTop());
          });

          var headerTD = $table.find('th');
          var counter = 0;
      $('#reviewTable tr').eq(0).find('> th').each(function(e){
        headerTD.eq(counter).width($(this).width());
        counter++;
      });
        }


        function hideExtraCharacters() {
            var fieldsName = ['strength', 'weekness', 'impact', 'risk', 'contingencies-recommendation', 'objective', 'awardLetter'];
            for(var i = 0; i < fieldsName.length; i++) {
                hideExtraCharacterFromField(fieldsName[i]);
            }
        }

        function manageApprovalDropDown() {
            var proposalListSize = parseInt($('#proposalList').val());
            for(var i = 1; i <= proposalListSize; i++) {
                if($('.screcommendation'+i).val() == '' || $('.screcommendation'+i).val() == undefined || $('.screcommendation'+i).val() == null ||
                    $('.teamRecommendation'+i).val() == '' || $('.teamRecommendation'+i).val() == undefined || $('.teamRecommendation'+i).val() == null) {
                        $('.recommendation'+i).attr('disabled', 'disabled');
                } else {
                    $('.recommendation'+i).removeAttr('disabled');
                }
            }
        }

        function hideExtraCharacterFromField(fieldName) {
            var strengthFields = $('.' + fieldName);
            for(var i = 0; i < strengthFields.length; i++) {
                $('.' + fieldName).eq(i).text($('.' + fieldName).eq(i).text().replace(/\n/g , " "));
                if(strengthFields.eq(i).text().length > 100) {
                    $('.' + fieldName).eq(i).text($('.' + fieldName).eq(i).text().slice(0, 100));
                    $('.' + fieldName + (i+1)).removeClass('hidden');
                }
            }
        }

        function toggle22(class1,va){
            if(va){
                $(class1).show();
            } else {
                $(class1).hide();
            }
        }

        $(document).ready(function(){
            $('select[title="Search scope"]').hide();
            disabledPicklist();
            removePicklistVal();
            updateReccPicklistVal('{!isConceptPaper}');
            $(".filter-status option[value='']").remove();
        });

        function disabledPicklist() {
            $('.updateStatus').attr('disabled', 'disabled');
            $('.programversion').attr('disabled', 'disabled');
        }

        function removePicklistVal() {
            $(".status-dropdown option[value='Approved']").remove();
            $(".status-dropdown option[value='Completed']").remove();
            $(".status-dropdown option[value='Closed']").remove();
            $(".status-dropdown option[value='Cancelled']").remove();
            $(".status-dropdown option[value='Terminated']").remove();
            $(".status-dropdown option[value='Unsubmitted']").remove();
            $(".status-dropdown option[value='Received']").remove();
            $(".status-dropdown option[value='Installed/Operational']").remove();
            $(".status-dropdown option[value='Pending Approval']").remove();
            $(".status-dropdown option[value='Rejected']").remove();

            restrictPicklist();
        }

        function restrictPicklist() {
            if($(".status-dropdown").val() == 'Submitted') {
                $(".updateStatus option[value='Submitted']").remove();
                $(".updateStatus option[value='Under Review']").remove();
                $(".updateStatus option[value='Awarded']").remove();
                $(".updateStatus option[value='Not Awarded']").remove();

                $(".status-dropdown option[value='Under Review']").remove();
                $(".status-dropdown option[value='Awarded']").remove();
                $(".status-dropdown option[value='Not Awarded']").remove();

            } else if($(".status-dropdown").val() == 'Pending Review') {
                $(".updateStatus option[value='Submitted']").remove();
                $(".updateStatus option[value='Pending Review']").remove();
                $(".updateStatus option[value='Awarded']").remove();
                $(".updateStatus option[value='Not Awarded']").remove();

                $(".status-dropdown option[value='Submitted']").remove();
                $(".status-dropdown option[value='Awarded']").remove();
                $(".status-dropdown option[value='Not Awarded']").remove();
            }
        }


        function syncWithOtherRcmdIfApplicable(scoringCommitteeRec, projRecordId) {
          if(scoringCommitteeRec != undefined && scoringCommitteeRec != '') {
            if(projRecordId != undefined && projRecordId != '') {

                if(scoringCommitteeRec === 'Do Not Fund') {
                  // I-03031 - Once scoring committee recommendation is set to do not fund - automatically update team recommendation to do not fund
                  var teamRecClasssName = "teamRecommendationCls"+projRecordId;
                  $("."+teamRecClasssName).val('Do Not Fund');
                }
            }
          }
        }


        function updateReccPicklistVal(isConceptPaper) {
            if(isConceptPaper == 'false') {
                $(".recommendation option[value='Accepted']").remove();
                $(".recommendation option[value='Not Accepted']").remove();
                $(".screcommendation option[value='Accepted']").remove();
                $(".screcommendation option[value='Not Accepted']").remove();
            }

            if(isConceptPaper == 'true') {
                $(".recommendation option[value='Fund-Award']").remove();
                $(".recommendation option[value='Fundable']").remove();
                $(".recommendation option[value='Do Not Fund']").remove();
                $(".screcommendation option[value='Fundable']").remove();
                $(".screcommendation option[value='Do Not Fund']").remove();
            }
        }

        function saveAction() {
            var proposalListSize = parseInt($('#proposalList').val());
            console.log(proposalListSize);
            $('#errorMessage').hide();
            var hasError = false;
            for(var i = 1; i <= proposalListSize; i++) {
                var fundingLineTotal = 0;
                var hasFundingLine = false;
                $('.currencySBC'+i).each(function() {
                    if($(this).is(":visible")) {
                        fundingLineTotal += formatStringIntoNumber($(this).val());
                        hasFundingLine = true;
                    }
                });

                console.log('For Row -> ' + i);
                console.log(fundingLineTotal);

                var totalNYSERDAFunding = formatStringIntoNumber($('.currency'+i).val());
                console.log(totalNYSERDAFunding);

                if(hasFundingLine && totalNYSERDAFunding != fundingLineTotal) {
                    var errorString = $('.projectName'+i).text() + ' - ' + '{!$Label.Clean_Transportation_Funding_split_Message}';
                    $('.errStr').html(errorString);
                    $('#errorMessage').show();
                    hasError = true;
                    break;
                }
            }
            if(!hasError) {
                save();
            }
        }

        function saveRecordsJS() {
            var allowSave = true;
            $('.successMessage').hide();
            $('#errorMessage').hide();
            if('{!currentSolicitation.Score_Type__c}' == 'Batch Rank' && $('.selectAll').is(':visible')) {
                var count = 1;
                $( ".checkbox" ).each(function( index ) {
                   if($(this).is(":visible") && $('.status'+count).val() != 'Pending Review' && $('.assignedGroup'+count).val() == '') {
                        $('.errStr').html($('.projectName'+count).text() + ' - '+'Please assign group for scroing.');
                        $('#errorMessage').show();
                        $("html, body").animate({ scrollTop: 0 }, 600);
                        allowSave = false;
                        return false;
                   }
                   index++
                });
            }

            if(allowSave) {

                if(greenlightValueChanged != undefined && greenlightValueChanged == 'true') {
                    $('#greenlightChangeConfirmationModal').modal('show');
                    if(conceptPaperJSVar != undefined && conceptPaperJSVar == 'true') {
                      $('.statusDivGreenlight').html('{!$Label.CORE_Solicitation_Proposal_Review_page_Director_Approval_value_confirmation_Msg}');
                    } else {
                      $('.statusDivGreenlight').html('{!$Label.CORE_Solicitation_Proposal_Review_page_Greenlight_Approval_value_confirmationMsg}');
                    }
                } else {
                  openConfirmationMessage();
                }

            }
        }

        function saveProposals() {
            closeConfirmationMessage();
            saveRecords();
        }

        function openConfirmationMessage() {

            closeGreenlightConfirmationMessage();

            var allCheckbox = $('.checkbox');
            var firstStatus = $('.status1').val();
            for(var i = 1; i <= allCheckbox.length; i++) {
                if($('.checkbox'+i).prop('checked')) {
                    firstStatus = $('.status'+i).val();
                }
            }
            var applicationType = 'proposals';
            if('{!isConceptPaper}' == 'true') {
                applicationType = 'concept papers';
            }
            if(firstStatus != undefined) {
                $('#statusChangeConfirmationModal').modal('show');
                $('.statusDiv').html('Are you sure you would like to set the status to ' + firstStatus);
            } else {
                saveRecords();
            }
        }

        function closeConfirmationMessage() {
            $('#statusChangeConfirmationModal').modal('hide');
        }

        function closeGreenlightConfirmationMessage() {
            $('#greenlightChangeConfirmationModal').modal('hide');
        }

        function formatNumber(number, decimalPoint) {
            if(number != null && number != undefined && number != '') {
                if(typeof(number) == 'string') {
                    number = formatStringIntoNumber(number);
                }
                if(typeof(number) == 'number') {
                    if(decimalPoint == undefined) {
                        number = number.toFixed(2).replace(/(\d)(?=(\d{3})+\.)/g, '$1,');
                    } else {
                        if(decimalPoint == 0) {
                            number = number.toFixed(1).replace(/(\d)(?=(\d{3})+\.)/g, '$1,');
                            number = number.substring(0, number.length - 2);
                        }
                    }
                }
            }
            return number;
        }

        function formatStringIntoNumber(number) {
            if(number != null && number != undefined && number != '') {
                if(typeof(number) == 'string') {
                    number = number.replace(new RegExp(',', 'g'), '');
                    number = parseFloat(number);
                }
            }
            return number;
        }

        function openModal(){
             $('#editModal').modal('show');
        }

        function closeModal(){
            $('#editModal').modal('hide');
        }

        function clearmodalFormScoringWindow() {
          // Clear Modal window to avoid rerender issues. Do NOT use return keyword othewise Action attribute will not receive control.
          $('.modalFormScoringCls').empty();
        }

        function scoringCloseModal(){
            $('#scoringModal').modal('hide');
        }

        function clearMessage() {
            $("#validationErrorMessage").hide();
        }

        function fetchSelectedScorerJS() {
            $("#validationErrorMessage").hide();
            fetchSelectedScorer($('.scoringMember').val());
        }

        function SaveScoringProposalJS() {
            $("#validationErrorMessage").hide();
            if($('.score').val() == '' && $('.recuse').is(':checked') == false) {
                $('#validationErrorMessage').html('<strong>Error!</strong> Score: You must enter a value.');
                $('#validationErrorMessage').show();
                return false;
            }
            var strengthIdVal = $( "textarea[Id*='proposalStrengthTxtArea']" ).attr('ID');
            var weaknessIdVal = $( "textarea[Id*='proposalWeaknessTxtArea']" ).attr('ID');
            SaveScoringProposal(CKEDITOR.instances[strengthIdVal].getData(), CKEDITOR.instances[weaknessIdVal].getData());
        }

        function saveProjectReviewInformationJS() {
            var impactIdVal = $( "textarea[Id*='impactTxtArea']" ).attr('ID');
            var strengthIdVal = $( "textarea[Id*='strengthTxtArea']" ).attr('ID');
            var weaknessIdVal = $( "textarea[Id*='weaknessTxtArea']" ).attr('ID');
            var riskIdVal = $( "textarea[Id*='riskTxtArea']" ).attr('ID');
            var contingenciesIdVal = $( "textarea[Id*='contingenciesTxtArea']" ).attr('ID');
            var synopsisIdVal = $( "textarea[Id*='synopsisTxtArea']" ).attr('ID');
            var additionalInfoVal = $( "textarea[Id*='addInfoAwardTxtArea']" ).attr('ID');
            var additionalInfoValDATA = "";
            if ($( "textarea[Id*='addInfoAwardTxtArea']" ) != undefined) {
               additionalInfoValDATA = $( "textarea[Id*='addInfoAwardTxtArea']" ).val();
            }
            saveProjectReviewInformation(CKEDITOR.instances[impactIdVal].getData(), CKEDITOR.instances[strengthIdVal].getData(), CKEDITOR.instances[weaknessIdVal].getData(), CKEDITOR.instances[riskIdVal].getData(), CKEDITOR.instances[contingenciesIdVal].getData(), CKEDITOR.instances[synopsisIdVal].getData(),additionalInfoValDATA);
        }

        function showMatrixSuccessMsg(isSuccess) {
            $("#validationSuccessMessage").hide();
            if(isSuccess == 'true') {
                $('#validationSuccessMessage').html('Score Matrix has been successfully updated.');
                $('#validationSuccessMessage').show();
                return false;
            }
        }

        function selectAllCheckbox() {
            var allCheckbox = $('.checkbox');
            for(var i = 1; i <= allCheckbox.length; i++) {
                $('.checkbox'+i).prop('checked', $('.selectAll').prop('checked'));
            }
            if(!$('.selectAll').prop('checked')) {
                $('.updateStatus').attr('disabled', 'disabled');
            } else {
                $('.updateStatus').removeAttr('disabled', 'disabled');
            }
        }

        function changeSelectedStatus() {
            var updatedStatus = $('.updateStatus').val();
            if(updatedStatus == '' || updatedStatus == null || updatedStatus == undefined) {
                updatedStatus = $('.filter-status').val();
            }
            var allCheckbox = $('.checkbox');
            for(var i = 1; i <= allCheckbox.length; i++) {
                if($('.checkbox'+i).prop('checked')) {
                    $('.status'+i).val(updatedStatus);
                }
            }
        }


        function checkForPicklistDisbaled() {
            var isEnabled = false;
            var allCheckbox = $('.checkbox');
            for(var i = 1; i <= allCheckbox.length; i++) {
                if($('.checkbox'+i).prop('checked')) {
                    isEnabled = true;
                    break;
                }
            }
            if(!isEnabled) {
                $('.updateStatus').attr('disabled', 'disabled');
            } else {
                $('.updateStatus').removeAttr('disabled', 'disabled');
            }
        }

        function setAmountField(amountToDistribute, parentRowNumber, rowNumber) {
            console.log(amountToDistribute + '  ' + parentRowNumber + '  ' +  rowNumber);
            console.log(rowNumber);

            if(!$('.amountCB'+parentRowNumber+rowNumber)[0].checked) {
                $('.disAmount'+parentRowNumber+rowNumber).val(null);
            }
        }

        function saveScoreMatrixJS() {
            saveScoreMatrix();
        }

        function isNumberOnly(evt, currentValue) {
            var charCode = (evt.which) ? evt.which : evt.keyCode;
            var str = String.fromCharCode(charCode);
            if(evt.shiftKey){
                evt.preventDefault();
                return false;
            }
            if(((charCode > 47 && charCode < 58) || (charCode >= 96 && charCode <= 105) || charCode == 8 || charCode == 9 || (charCode >= 37 && charCode <= 40)) && (parseInt(currentValue.value + str) <= 100)) {
                return true;
            }
            else{
                evt.preventDefault();
                return false;
            }
        }

        function scoreNumberOnly(evt) {
            var charCode = (evt.which) ? evt.which : evt.keyCode;
            if (evt.shiftKey) {
                evt.preventDefault();
                return false;
            }
            if ((charCode > 47 && charCode < 58) || (charCode >= 96 && charCode <= 105) || charCode == 8 || charCode == 9 || (charCode >= 37 && charCode <= 40) ||
                                    charCode == 110 || charCode == 190) {
                return true;
            } else {
                evt.preventDefault();
                return false;
            }
        }
    </script>

    <apex:outputPanel id="scriptPanel">
        <script>
            $(document).ready(function(){
                jQuery("html").attr("lang", "en");

                  // Accessibility fix
                  try {
                    $('#zen-moreTabsAssistiveLink').html("<b><span style='display:none'>more tabs</span></b>");
                    $('#phSearchClearButton').html("<b><span style='display:none'>clear search</span></b>");
                  } catch (err) {
                    // Do nothing
                  }
                  // EndOf:  Accessibility fix
            });


            function openScoringModal() {
                console.log('{!hasAlreadyScoreGiven}');
                if('{!hasAlreadyScoreGiven}' == 'true') {
                    openConfirmationPopup();
                } else {
                    scoringOpenModal();
                }
            }

            function openConfirmationPopup() {
                $('#confirmationModal').modal('show');
            }

            function closeConfirmationPopup() {
                $('#confirmationModal').modal('hide');
            }

            function openManageGroupPopup() {
                $('#manageGroupModal').modal('show');
            }

            function refreshMainTableJS() {
                refreshMainTable();
            }

            function closeManageGroupPopup() {
                $('#manageGroupModal').modal('hide');
            }

            var delGroupId;
            function openGroupDelConfirmationPopup(groupId) {
                if(confirm('Are you sure you want to delete this group? Please note that this cannot be undone once confirmed.')) {
                    delGroupId = groupId;
                    deleteGroup();
                }
            }

            function openGroupMemberDelConfirmationPopup(groupMemberId, groupId) {
                if(confirm('Are you sure you want to delete this member? This note that this cannot be undone once confirmed.')) {
                    deleteSolicitationGroupMember(groupMemberId, groupId);
                }
            }

            function deleteGroup() {
                deleteSolicitationGroup(delGroupId);
            }

            function closeGroupDelConfirmationPopup() {
                $('#confirmationModal1').modal('hide');
            }

            function showValue(fieldValue, headerValue) {
                console.log(fieldValue);
                $('#showMoreModal').modal('show');
                $('#headerName').html(headerValue);
                $('.showMoreDiv').html(fieldValue);
            }

            function openEditBox(groupId) {
                $('#editDiv'+groupId).removeClass('hidden');
                $('#editDiv1'+groupId).removeClass('hidden');
                $('#GroupSection'+groupId).addClass('hidden');
                $('#GroupSection1'+groupId).addClass('hidden');
            }

            function closeEditBox(groupId) {
                $('#editDiv'+groupId).addClass('hidden');
                $('#editDiv1'+groupId).addClass('hidden');
                $('#GroupSection'+groupId).removeClass('hidden');
                $('#GroupSection1'+groupId).removeClass('hidden');
            }

            function saveGroup(groupId) {
                var newEditGroupName = $('.groupEditedName'+groupId).val();
                saveGroupRec(groupId, newEditGroupName);
            }

            function scoringOpenModal() {
                closeConfirmationPopup();
                $("#validationErrorMessage").hide();
                $('#scoringModal').modal('show');
                var strengthIdVal = $( "textarea[Id*='proposalStrengthTxtArea']" ).attr('ID');
                var weaknessIdVal = $( "textarea[Id*='proposalWeaknessTxtArea']" ).attr('ID');
                var editor1 = CKEDITOR.replace(strengthIdVal,{height: '80px', resize_dir: 'both', removeButtons: 'Maximize,Source,Image,HiddenField,Anchor,Styles,Format,Scayt,Blockquote,Cut,Copy,Paste,PasteText,PasteFromWord,Table,HorizontalRule,SpecialChar,Subscript,Superscript,RemoveFormat'} );
                var editor2 = CKEDITOR.replace(weaknessIdVal,{height: '80px', resize_dir: 'both', removeButtons: 'Maximize,Source,Image,HiddenField,Anchor,Styles,Format,Scayt,Blockquote,Cut,Copy,Paste,PasteText,PasteFromWord,Table,HorizontalRule,SpecialChar,Subscript,Superscript,RemoveFormat'} );

                // disableNativeSpellChecker: false, scayt_autoStartup: true,

                console.log(editor2);
            }

            function matrixScoringOpenModal() {
                $("#validationSuccessMessage").hide();
                $('#matrixScoringModal').modal('show');
                $('.add-sort').addClass('cursor-pointer');
            }

            function openNotificationPreviewModelWindow() {
              $('#previewNotification').modal('show');
              //$('.recommendationNotification').val('');
              updateReccPicklistVal('{!isConceptPaper}');
            }

            function projectReviewOpenModal() {
                $("#validationProjReviewSuccessMessage").hide();
                $('#projectReviewModal').modal('show');
                var impactIdVal = $( "textarea[Id*='impactTxtArea']" ).attr('ID');
                var strengthIdVal = $( "textarea[Id*='strengthTxtArea']" ).attr('ID');
                var weaknessIdVal = $( "textarea[Id*='weaknessTxtArea']" ).attr('ID');
                var riskIdVal = $( "textarea[Id*='riskTxtArea']" ).attr('ID');
                var contingenciesIdVal = $( "textarea[Id*='contingenciesTxtArea']" ).attr('ID');
                var synopsisIdVal = $( "textarea[Id*='synopsisTxtArea']" ).attr('ID');
                CKEDITOR.replace(impactIdVal,{height: '80px', resize_dir: 'both', removeButtons: 'Maximize,Source,Image,HiddenField,Anchor,Styles,Format,Scayt,Blockquote,Cut,Copy,Paste,PasteText,PasteFromWord,Table,HorizontalRule,SpecialChar,Subscript,Superscript,RemoveFormat'} );
                CKEDITOR.replace(strengthIdVal,{height: '80px', resize_dir: 'both', removeButtons: 'Maximize,Source,Image,HiddenField,Anchor,Styles,Format,Scayt,Blockquote,Cut,Copy,Paste,PasteText,PasteFromWord,Table,HorizontalRule,SpecialChar,Subscript,Superscript,RemoveFormat'} );
                CKEDITOR.replace(weaknessIdVal,{height: '80px', resize_dir: 'both', removeButtons: 'Maximize,Source,Image,HiddenField,Anchor,Styles,Format,Scayt,Blockquote,Cut,Copy,Paste,PasteText,PasteFromWord,Table,HorizontalRule,SpecialChar,Subscript,Superscript,RemoveFormat'} );
                CKEDITOR.replace(riskIdVal,{height: '80px', resize_dir: 'both', removeButtons: 'Maximize,Source,Image,HiddenField,Anchor,Styles,Format,Scayt,Blockquote,Cut,Copy,Paste,PasteText,PasteFromWord,Table,HorizontalRule,SpecialChar,Subscript,Superscript,RemoveFormat'} );
                CKEDITOR.replace(contingenciesIdVal,{height: '80px', resize_dir: 'both', removeButtons: 'Maximize,Source,Image,HiddenField,Anchor,Styles,Format,Scayt,Blockquote,Cut,Copy,Paste,PasteText,PasteFromWord,Table,HorizontalRule,SpecialChar,Subscript,Superscript,RemoveFormat'} );
                CKEDITOR.replace(synopsisIdVal,{height: '80px', resize_dir: 'both', removeButtons: 'Maximize,Source,Image,HiddenField,Anchor,Styles,Format,Scayt,Blockquote,Cut,Copy,Paste,PasteText,PasteFromWord,Table,HorizontalRule,SpecialChar,Subscript,Superscript,RemoveFormat'} );
              //CKEDITOR.removePlugins = 'contextmenu,liststyle,tabletools';
            }

            /*CKEDITOR.editorConfig = function(config) {
              config.removePlugins = 'contextmenu,liststyle,tabletools';
            }*/

            function projectReviewCloseModal() {
                $("#validationProjReviewSuccessMessage").hide();
                $('#projectReviewModal').modal('hide');
            }

            function projectReviewShowMessage(isSuccess){
                $("#validationProjReviewSuccessMessage").hide();
                if(isSuccess == 'true') {
                   // $('#validationProjReviewSuccessMessage').html('Information has been successfully saved.');
                   // $('#validationProjReviewSuccessMessage').show();
                }
                projectReviewCloseModal();
            }

            function openNav() {
                document.getElementById("mySidenav").style.width = "250px";
            }

            function closeNav() {
                document.getElementById("mySidenav").style.width = "0";
            }

            function openFinalizeScoreConfirmationModal() {
                $('#scoreFinalizeConfirmation').modal('show');
            }

            function closeFinalizeScoreConfirmationModal() {
                window.location.reload();
            }

            function openSelectedGroup(groupId) {
                $('#headingGroupSection'+groupId + ' a').removeClass('collapsed');
                $('#'+groupId).addClass('in');
                $('#'+groupId).removeAttr('style');
            }

            function resetSelectAllCheckbox() {
                $('.selectAll').prop('checked', false);
            }

            hideExtraCharacters();
            setTimeout(function() {
                manageTable();
            }, 400);
            manageApprovalDropDown();
            updateReccPicklistVal('{!isConceptPaper}');
            restrictPicklist();


         function sortTable(tableUniqueId, n) {
                var table, rows, switching, i, x, y, shouldSwitch, dir, switchcount = 0;
                table = document.getElementById("matrixTable" + tableUniqueId);
                switching = true;

                //Set the sorting direction to ascending:
                dir = "asc";
                addAscIcon(tableUniqueId);
                while (switching) {
                    switching = false;
                    rows = table.getElementsByTagName("tr");
                    for (i = 1; i < (rows.length - 1); i++) {
                        shouldSwitch = false;
                        x = rows[i].getElementsByTagName("td")[n];
                        y = rows[i + 1].getElementsByTagName("td")[n];
                        if (dir == "asc") {
                            if (x.innerHTML.toLowerCase() > y.innerHTML.toLowerCase()) {
                                shouldSwitch= true;
                                break;
                            }
                        } else if (dir == "desc") {
                            if (x.innerHTML.toLowerCase() < y.innerHTML.toLowerCase()) {
                                shouldSwitch= true;
                                break;
                            }
                        }
                    }
                    if (shouldSwitch) {
                        rows[i].parentNode.insertBefore(rows[i + 1], rows[i]);
                        switching = true;
                        switchcount ++;
                    } else {
                        if (switchcount == 0 && dir == "asc") {
                            dir = "desc";
                            addDescIcon(tableUniqueId);
                            switching = true;
                        }
                    }
                }
            }

            function addDescIcon(tblNum) {
                $('.sorting-icon.tbl'+tblNum).removeClass('fa-sort-asc');
                $('.sorting-icon.tbl'+tblNum).addClass('fa-sort-desc');
            }

            function addAscIcon(tblNum) {
                $('.sorting-icon.tbl'+tblNum).removeClass('fa-sort-desc');
                $('.sorting-icon.tbl'+tblNum).removeClass('fa-sort');
                $('.sorting-icon.tbl'+tblNum).addClass('fa-sort-asc');
            }

        </script>
    </apex:outputPanel>

</apex:page>